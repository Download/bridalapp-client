define("bridalapp/class",[],function(){function Class(){var name="",parent=null,args=arrayify(arguments);("string"==typeof args[0]||args[0]instanceof String)&&(name=args.shift()),"function"==typeof args[0]&&(parent=args.shift());var classname=name||"klass";if(eval("var klass = function "+classname+"() {this.initialize.apply(this, arguments);}"),klass.classname=classname,klass.superclass=parent,klass.subclasses=[],parent){var subclass=function(){};subclass.prototype=parent.prototype,klass.prototype=new subclass,parent.subclasses.push(klass)}for(var i=0,len=args.length;len>i;i++)addMethods(klass,args[i]);return klass.prototype.initialize||(klass.prototype.initialize=function(){}),klass.prototype.constructor=klass,klass}function argumentNames(e){var t,n,r=e.toString().match(/^[\s\(]*function[^(]*\((.*?)\)/)[1].split(",");for(t=0,n=r.length;n>t;t++)r[t]=r[t].replace(/^\s+/,"").replace(/\s+$/,"");return 1!==n||r[0]?r:[]}function arrayify(e){if(!e)return[];if("toArray"in Object(e))return e.toArray();for(var t=e.length||0,n=new Array(t);t--;)n[t]=e[t];return n}function bind(e){if(arguments.length<3&&void 0===arguments[1])return e;var t=arrayify(arguments),n=t.splice(0,2)[1];return function(){return e.apply(n,t.concat(arrayify(arguments)))}}function wrap(e,t){return function(){return t.apply(this,[bind(e,this)].concat(arrayify(arguments)))}}function addMethods(e,t){function n(e){var t=[];for(var n in e)t.push(n);return t}for(var r,i=e.superclass&&e.superclass.prototype,a=n(t),s=0;r=a[s];s++){var o=t[r];if(i&&"function"==typeof o){var c=argumentNames(o);if(c.length>0&&"$super"===c[0]){var l=o;o=wrap(function(e){return function(){return i[e].apply(this,arguments)}}(r),l),o.valueOf=bind(l.valueOf,l),o.toString=bind(l.toString,l)}}e.prototype[r]=o}}return Class.subclass=function(e,t){if(e){if(e.classname===t)return e;for(var n,r=0;n=e.subclasses[r];r++){if(n.classname===t)return n;var i=Class.subclass(n,t);if(i)return i}}},Class}),define("bridalapp/log",[],function(){function e(){return i}var t,n,r=["log","info","warn","error"],i="console"in this&&console.error?console:{},a={},s={};for(t=0;n=r[t];t++)s[n]=function(){},a[n]=i[n]||s[n];e.level=function(e){if(void 0!==e&&e>=0&&4>=e&&e!==o){o=e;for(var t,n=0;t=r[n];n++)i[t]=n>=e?a[t]:s[t]}return o},e.level.DEBUG=0,e.level.INFO=1,e.level.WARN=2,e.level.ERROR=3,e.level.NONE=4;var o=e.level(e.level.INFO);return e}),define("bridalapp/datastore",["bridalapp/class"],function(e){"use strict";var t=e("DataStore",{initialize:function(e,t,n){this.name=e,this.url=t||"",this.cfg=n||{},this.cfg.listeners=this.cfg.listeners||{},this.cfg.throttle=this.cfg.throttle||{}},on:function(e,t){this.cfg.listeners[e]=this.cfg.listeners[e]||[],this.cfg.listeners[e].push(t)},trigger:function(e){var t=this,n=t.cfg,r=n.listeners[e];if(r){n.throttle[e]||(n.throttle[e]={triggered:Date.now()});var i=n.throttle[e];i.timeout&&Date.now()<i.triggered+250?clearTimeout(i.timeout):i.triggered=Date.now(),i.timeout=setTimeout(function(){for(var e,n=0;e=r[n];n++)e.call(t);i.timeout=null},10)}},off:function(e,t){if(this.cfg.listeners[e]){if(!t){var n=this.cfg.listeners[e];return delete this.cfg.listeners[e],n}for(var r=this.cfg.listeners[e].length-1;r>=0;r--)if(this.cfg.listeners[e][r]===t)return this.cfg.listeners[e].splice(r,1)}},load:function(){return new Promise(function(e){e([])})},count:function(){return new Promise(function(e){e(0)})},save:function(e){return new Promise(function(t){t(void 0===e.length?[e]:e)})},"delete":function(e){return new Promise(function(t){t("length"in e?e:[e])})},toString:function(){return"[Object "+this.constructor.classname+" '"+this.name+"' {url: '"+this.url+"'}]"}});return t.typeFactories={},t.registerType=function(e,n){t.typeFactories[e]||(t.typeFactories[e]=n)},t.fromType=function(e,n,r,i){return t.typeFactories[n](e,r,i)},t.fromUrl=function(e,n,r){if(!n)return null;var i=n.indexOf("://"),a=n.substring(0,i),s="https"===a?"http":a||"http";return t.fromType(e,s,n,r)},t}),define("bridalapp/synchabledatastore",["suid","bridalapp/class","bridalapp/datastore"],function(e,t,n){"use strict";var r=t("SynchableDataStore",n,{initialize:function($super,e,t,n){$super(e,t,n)},get:function(e,t,n,r){var i=r?Persistent.clone(this.items()):this.items();return Persistent.page(Persistent.matches(i,e),t,n)},len:function(e){return this.get(e).length},looksSynched:function(){return 0!==this.lastSynched().getTime()&&!(this.createdItems().length||this.updatedItems().length||this.deletedItems().length)},synch:function(){return new Promise(function(e){e()})},isSynching:function(){return!1},lastSynched:function(e){return e||new Date},items:function(){},createdItems:function(){return[]},updatedItems:function(){return[]},deletedItems:function(){return[]},staleItems:function(){return[]},failedItems:function(){return[]},futureItems:function(){return[]},set:function(e){return e},del:function(e){return e},toString:function($super){var e=$super();return e=e.substring(0,e.length-2),"[Object "+this.constructor.classname+" '"+this.name+"' {url: '"+this.url+"', lastSynched:"+this.lastSynched()+", items:"+this.items().length+", created:"+this.createdItems().length+", updated:"+this.updatedItems().length+", deleted:"+this.deletedItems().length+", stale:"+this.staleItems().length+", failed:"+this.failedItems().length+"}]"}});return r}),define("bridalapp/persistent",["bridalapp/class","suid"],function(e,t){var n=e("Persistent",{initialize:function(e){this.id=e&&e.id||t(0),this.type=this.constructor.classname,this.version=e&&void 0!==e.version?e.version:null},equals:function(e){return e&&(e instanceof n&&e.id.value===this.id.value||e instanceof t&&e.value===this.id.value||e==this.id.value)},toString:function(){return"[Object "+this.type+" "+this.toStringProperties()+"]"},toStringProperties:function(){return this.id.toString()+" v"+this.version}});return n.revive=function(r,i){var a=i&&"object"==typeof i&&"string"==typeof i.type&&i.type,s=e.subclass(n,a);return s?new s(i):t.revive(r,i)},n.fromJSON=function(e){return JSON.parse(e,n.revive)},n.persistent=function(e){if(1===arguments.length)return e instanceof n&&null!==e.version;for(var t=[],r=0;e=arguments[r];r++)if(n.persistent(e))t.push(e);else if("length"in e)for(var i,a=0;i=e[a];a++)n.persistent(i)&&t.push(i);return t},n.equals=function(e,t,n){return e==t||n&&0===n(e,t)||e&&e.equals&&e.equals(t)||t&&t.equals&&t.equals(e)||"object"==typeof e&&e&&e.valueOf()==t||"object"==typeof t&&t&&t.valueOf()==e},n.indexOf=function(e,t){for(var r,i=0;r=e[i];i++)if(n.equals(r,t))return i;return-1},n.matches=function(e,t){var r=Array.prototype.concat.call(e||[]);if(t)for(var i=r.length-1;i>=0;i--)for(var a in t)t.hasOwnProperty(a)&&((Array.isArray&&Array.isArray(t[a])||t[a]instanceof Array)&&-1===n.indexOf(t[a],e[i][a])||!n.equals(e[i][a],t[a]))&&r.splice(i,1);return r},n.pluck=function(e,t){for(var n,r=[],i=0;n=e[i];i++)void 0!==n[t]&&r.push(n[t]);return r},n.clone=function(e){var t=[];if(arguments.length>1)return n.clone(arguments);if(!("length"in e))return e instanceof n&&e.clone?e.clone():n.fromJSON(JSON.stringify(e));for(var r,t=[],i=0;r=e[i];i++)t.push(n.clone(r));return t},n.page=function(e,t,n){if(t){var r=(n||0)*t,i=n*(t+1);return 0>i||r>=i||r>e.length?[]:e.slice(Math.max(r,0),Math.min(i,e.length))}return e},n.eachArg=function(e,t,r){if("length"in e&&!(e instanceof n)){for(var i,a=[],s=0;i=e[s];s++)a.push.apply(a,n.eachArg(i,t,r));return a}return r.call(t,e)},n}),define("bridalapp/rhaboodatastore",["bridalapp/class","bridalapp/log","bridalapp/datastore","bridalapp/synchabledatastore","bridalapp/persistent","rhaboo"],function(e,t,n,r,i){"use strict";var a=e("RhabooDataStore",r,{initialize:function($super,e,n,r){if(t().log("Initializing RhabooDataStore `"+e+"`..."),$super(e,n,r),!this.cfg.rhaboo||!this.cfg.store){var i=n.indexOf("://")+3,a=n.lastIndexOf("/"),s=n.substring(i,a),o=n.substring(a+1);this.cfg.repo||(this.cfg.repo=s),this.cfg.store||(this.cfg.store=o)}t().log("Initialized RhabooDataStore `"+e+"`.")},load:function(e,n,r){t().log("Loading RhabooDataStore `"+name+"`...");var i=this;return new Promise(function(a){a(i.get(e,n,r)),t().log("Loaded RhabooDataStore `"+name+"`.")})},count:function(e){t().log("RhabooDataStore `"+name+"` count() starting (criteria="+e+")...");var n=this;return new Promise(function(e){e(n.len()),t().log("RhabooDataStore `"+name+"` count() done: "+n.len()+".")})},save:function(e){t().log("RhabooDataStore `"+name+"` save() starting (item="+e+")...");var n=this;return new Promise(function(r){r(n.set(e)),t().log("RhabooDataStore `"+name+"` save() done.")})},"delete":function(e){t().log("RhabooDataStore `"+name+"` delete() starting (item="+e+")...");var n=this;return new Promise(function(r){r(n.del(e)),t().log("RhabooDataStore `"+name+"` delete() done.")})},set:function(e){t().log("RhabooDataStore `"+name+"` set() starting (item="+e+")...");var n=i.eachArg(arguments,this,function(e){var t=null,n=i.indexOf(this.db().items,e);return-1===n?this.db().items.push(e):t=this.db().items.splice(n,1,e)[0],n=i.indexOf(this.db().deleted,e),-1!==n&&(t=this.db().deleted.splice(n,1)),t&&(n=i.indexOf(this.db().updated,e),-1===n?this.db().updated.push(t):this.synching&&(n=i.indexOf(this.db().future,e),-1===n?this.db().future.push(e):this.db().future.splice(n,1,e))),[e]});return t().log("RhabooDataStore `"+name+"` set(): triggering change event."),this.trigger("change"),t().log("RhabooDataStore `"+name+"` set(): done."),n},del:function(e){t().log("RhabooDataStore `"+name+"` del() starting (item="+e+")...");var n=i.eachArg(arguments,this,function(e){var t,n=i.indexOf(this.items(),e);if(-1!==n&&(t=this.items().splice(n,1)[0]),i.persistent(e)){if(n=i.indexOf(this.db().updated,e),-1!==n){var r=this.db().updated.splice(n,1);t=t||r}n=i.indexOf(this.db().future,e),-1!==n&&this.db().future.splice(n,1),n=i.indexOf(this.db().deleted,e),-1===n&&this.db().deleted.push(t||e)}return[t||e]});return t().log("RhabooDataStore `"+name+"` del(): triggering change event."),this.trigger("change"),t().log("RhabooDataStore `"+name+"` del(): done."),n},lastSynched:function(e){return e&&this.db().write("lastSynched",e),this.db().lastSynched},items:function(){return this.db().items},createdItems:function(){for(var e,t=[],n=0;e=this.items()[n];n++)i.persistent(e)||t.push(e);return t},updatedItems:function(){return this.db().updated},deletedItems:function(){return this.db().deleted},staleItems:function(){return this.db().stale},failedItems:function(){return this.db().failed},futureItems:function(){return this.db().future},db:function(){if(!this.cfg.rhaboo){this.cfg.rhaboo=Rhaboo.persistent(this.cfg.repo),this.cfg.rhaboo[this.cfg.store]||this.cfg.rhaboo.write(this.cfg.store,{});for(var e,t=0;e=["items","updated","deleted","stale","failed","future"][t];t++)this.db()[e]||this.db().write(e,[]);this.db().lastSynched||this.db().write("lastSynched",new Date(0))}return this.cfg.rhaboo[this.cfg.store]}});return n.registerType("rhaboo",function(e,t,n){return new a(e,t,n)}),a}),define("bridalapp/restdatastore",["bridalapp/class","jquery","bridalapp/log","bridalapp/persistent","bridalapp/datastore"],function(e,t,n,r,i){"use strict";function a(e,t,n){return new s(e,t,n)}var s=e("RestDataStore",i,{initialize:function($super,e,t,n){$super(e,t,n),this.cfg.retryCount=this.cfg.retryCount||0,this.cfg.retryWaitTime=this.cfg.retryWaitTime||2e3,this.cfg.timeout=this.cfg.timeout||1e4,void 0===this.cfg.supportsSynch&&(this.cfg.supportsSynch=!1)},load:function(e,t,n){return this.remoteRequest("GET",this.url,{criteria:e,pageSize:t,pageIndex:n})},count:function(e){return new Promise(function(t,n){this.remoteRequest("GET",this.url,{criteria:e}).then(function(e){t(e.length)})["catch"](function(e){n(e)})})},save:function(e){var t=r.eachArg(e,this,function(e){return[e]});return this.remoteRequest("POST",this.url+"/save",t)},"delete":function(e){var t=r.eachArg(e,this,function(e){return[e]});return this.remoteRequest("DELETE",this.url,t)},synch:function(e){return this.remoteRequest("POST",this.url+"/synch",e)},remoteRequest:function(e,i,a){return function(e,i,a,s,o){function c(e){var t="";if(e)if(e.length)t="("+e.length+" items)";else if(e.createdItems){var n=[];e.createdItems.length&&n.push(e.createdItems.length+" created"),e.updatedItems.length&&n.push(e.updatedItems.length+" updated"),e.deletedItems&&e.deletedItems.length&&n.push(e.deletedItems.length+" deleted"),e.deletedIds&&e.deletedIds.length&&n.push(e.deletedIds.length+" deleted"),n.length&&(t="("+n.join(", ")+")")}return t}function l(e,i,a,l,d,u){for(var h="",f=0;f<6-e.length;f++)h+=" ";n().log(" -> "+h+e+" "+i+" "+c(a)),t.ajax(i,{method:e,contentType:"application/json",processData:!1,data:a&&JSON.stringify(a),timeout:s}).done(function(t,a,s){-1!==s.responseText.indexOf("j_security_check")?(n().info("401 "+h+e+" "+i+" "+c(t)+" (LOGIN CHALLENGE)"),l(s,e,i,t,d,u)):(n().info("200 "+h+e+" "+i+" "+c(t)+" (OK)"),o=0,d(r.fromJSON(s.responseText)))}).fail(function(t,r,s){t.statusText=s||r,n().warn(t.status+" "+h+e+" "+i+" "+c(a)+" ("+t.statusText+")"),l(t,e,i,a,d,u)})}function d(e,t,n,r,i,a){var s=e.statusText;switch(status){case 500:case 502:case 503:case 504:if(o>0){u(e,t,n,r,errorHandler,i,a);break}case 200:200==e.status&&(s="Session expired.");default:o=0;var c=new Error(e.status+" "+s);c.status=e.status,c.statusText=s,c.request=e,c.method=t,c.url=n,c.data=r,a(c)}}function u(e,t,n,r,i,a,s){o--;var c=3e3,d=e.getResponseHeader("Retry-After");if(d){var u=parseInt(d,10);isNaN(u)||(c=1e3*u)}setTimeout(function(){l(t,n,r,errorhandler,a,s)},c)}Date.now();return new Promise(function(t,n){if("GET"===e&&a){var r=i.indexOf("#"),s=-1!==r?i.substring(r):"",o=i.indexOf("?"),c=-1!==o?i.substring(o):"";if(a.criteria)for(var u in a.criteria)a.criteria.hasOwnProperty(u)&&(c+=(c?"&":"")+encodeURIComponent(u)+"="+encodeURIComponent(a.criteria[u].toString()));a.pageSize&&(c+=(c?"&":"")+"pg="+a.pageIndex+"&pgsz="+a.pageSize),i=i+c+s,a=void 0}l(e,i,a,d,t,n)})}(e,i,a,this.cfg.timeout,this.cfg.retryCount,this.cfg.retryWaitTime)}});return i.registerType("http",a),i.registerType("https",a),s}),define("bridalapp/named",["bridalapp/class","bridalapp/persistent"],function(e,t){var n=e("Named",t,{initialize:function($super,e){$super(e),this.name=e&&e.name||null},toString:function(){return"[Object "+this.type+" '"+this.name+"' "+this.id.toString()+" v"+this.version+"]"}});return n}),define("bridalapp/account",["bridalapp/class","bridalapp/named"],function(e,t){var n=e("Account",t,{initialize:function($super,e){$super(e),this.roles=e&&e.roles||[],this.groups=e&&e.groups||[],this.credentials=e&&e.credentials||[]}});return n}),define("bridalapp/brand",["bridalapp/class","bridalapp/named"],function(e,t){var n=e("Brand",t,{initialize:function($super,e){$super(e)}});return n}),define("bridalapp/synchrequest",["bridalapp/class"],function(e){var t=e("SynchRequest",{initialize:function(e){this.unsynchedDuration=e&&e.synchDuration||0,this.criteria=e&&e.criteria||null,this.currentIds=e&&e.currentIds||[],this.currentVersions=e&&e.currentVersions||[],this.createdItems=e&&e.createdItems||[],this.updatedItems=e&&e.updatedItems||[],this.deletedItems=e&&e.deletedItems||[]}});return t}),define("bridalapp/synchresponse",["bridalapp/class"],function(e){var t=e("SynchResponse",{initialize:function(e){this.createdItems=e&&e.createdItems||[],this.updatedItems=e&&e.updatedItems||[],this.staleItems=e&&e.staleItems||[],this.failedItems=e&&e.failedItems||[],this.deletedIds=e&&e.deletedIds||[]}});return t}),define("bridalapp/syncheddatastore",["bridalapp/class","jquery","bridalapp/log","bridalapp/persistent","bridalapp/datastore","bridalapp/synchabledatastore","bridalapp/synchrequest","bridalapp/synchresponse"],function(e,t,n,r,i,a,s){"use strict";function o(e,t){for(var n,i,a,s=!1,o=0;n=t[o];o++)a=r.indexOf(e.items(),n),-1===a?(a=r.indexOf(e.deletedItems(),n),-1!==a?n.version!==e.deletedItems()[a].version&&(e.deletedItems().splice(a,1),e.items().push(n)):e.items().push(n),s=!0):n.version!==e.items()[a].version&&(i=e.items().splice(a,1,n)[0],a=r.indexOf(e.updatedItems(),i),-1!==a&&(e.updatedItems().splice(a,1),a=r.indexOf(e.staleItems(),i),-1===a?e.staleItems().push(i):e.staleItems().splice(a,1,i)),s=!0);for(var o=e.items().length-1;o>=0;o--)if(n=e.items()[o],-1===r.indexOf(t,n)&&-1===r.indexOf(e.createdItems(),n)){var i=e.items().splice(o,1)[0];a=r.indexOf(e.updatedItems(),i),-1!==a&&(this.updatedItems().splice(a,1),a=r.indexOf(e.staleItems(),i),-1===staleIdx?e.staleItems().push(i):e.staleItems().splice(a,1,i)),s=!0}s&&e.trigger("change")}function c(e,t){for(var n,i=0;n=t[i];i++){var a=r.indexOf(e.futureItems(),n);if(-1!==a){var s=e.futureItems().splice(a,1)[0];a=r.indexOf(e.updatedItems(),n),-1!==a?e.updatedItems().splice(a,1,n):e.updatedItems().push(n);var o=r.clone(n);for(var c in s)"version"!==c&&(o[c]=s[c]);a=r.indexOf(e.items(),n),-1!==a&&e.items().splice(a,1,o)}else a=r.indexOf(e.updatedItems(),n),-1!==a&&e.updatedItems().splice(a,1),a=r.indexOf(e.items(),n),-1!==a&&e.items().splice(a,1,n)}}function l(e,t){for(var n,i=0;n=t[i];i++){var a=r.indexOf(e.deletedItems(),n);-1!==a&&e.deletedItems().splice(a,1)}}function d(e){var t=e.cfg;return e.synching=new Promise(function(n,i){return e.looksSynched()&&Date.now()<e.lastSynched().getTime()+t.pollInterval?setTimeout(function(){e.synching=!1,n()},0):(e.trigger("synch:started"),void t.remoteDataStore.load().then(function(a){o(e,a);for(var s,d=e.createdItems().concat(),u=0;s=e.updatedItems()[u];u++){var h=r.indexOf(e.items(),s);-1!==h&&d.push(e.items()[h])}var f=e.deletedItems().concat();new Promise(function(n,r){return f.length?void t.remoteDataStore["delete"](f).then(function(t){l(e,t),n()})["catch"](function(e){r(e)}):void n()}).then(function(){new Promise(function(n,r){return d.length?void t.remoteDataStore.save(d).then(function(t){c(e,t),n()})["catch"](function(e){r(e)}):void n()}).then(function(){e.lastSynched(new Date),e.synching=!1,e.synchError=!1,e.trigger("synch:success"),n(),e.trigger("synch:done")})["catch"](function(e){i(e)})})["catch"](function(e){i(e)})})["catch"](function(t){e.synching=!1,e.synchError=t,e.trigger("synch:failed"),i(t),e.trigger("synch:done")}))})}function u(e){e.autoSynchActive||(e.autoSynchActive=!0,setInterval(function(){e.synch()},e.cfg.synchInterval))}var h=e("SynchedDataStore",a,{initialize:function($super,e,t,r){if(n().log("Initializing SynchedDataStore `"+e+"`..."),$super(e,t,r),this.synching=!1,this.synchError=!1,r=this.cfg,void 0===r.autoSynch&&(r.autoSynch=!0),r.synchInterval||(r.synchInterval=3e4),r.pollInterval||(r.pollInterval=36e5),void 0===r.remoteSynch&&(r.remoteSynch=!0),!r.localDataStore||!r.remoteDataStore){var s=t.split("://")[1].split("#");if(!r.localDataStore){var o=s[0].split("/"),c=o[0],l=o.slice(1,o.length-1).join("/"),d=o[o.length-1];r.localDataStore=i.fromType(e,c,c+"://"+l+"/"+d),r.localDataStore instanceof a||n().error(r.localDataStore?"Unable to initialize SynchedDataStore '"+e+"'.Need a synchable datastore for the local side, but "+r.localDataStore+" is not a SynchableDataStore.":"Unable to initialize SynchedDataStore '"+e+"'.Need a synchable datastore for the local side, but could not find a datastore for url '"+s[0]+"'.")}if(!r.remoteDataStore){var u=s[1].split("/"),h=u[0],f=u.slice(1,u.length-1).join("/"),p=u[u.length-1];r.remoteDataStore=i.fromType(e,h,"/"+f+"/"+p),r.remoteDataStore||n().error("Unable to initialize SynchedDataStore '"+e+"'.Need a datastore for the remote side, but could not find a datastore for url '"+s[1]+"'.")}}n().log("Initialized SynchedDataStore `"+e+"`.")},synch:function($super,e){this.cfg.autoSynch&&u(this);var t=this,i=t.cfg;return t.synching?t.synching:(t.synchError=!1,i.remoteDataStore.cfg.supportsSynch?t.synching=new Promise(function(a,o){if(!e&&t.looksSynched()&&Date.now()<t.lastSynched().getTime()+i.pollInterval)return setTimeout(function(){t.synching=!1,a()},0);try{n().log("Synching SynchedDataStore `"+this.name+"`..."),t.trigger("synch:started");var c=!1,l=new s;l.criteria=i.filter||null,l.createdItems.push.apply(l.createdItems,t.createdItems()),l.updatedItems.push.apply(l.updatedItems,t.updatedItems()),l.deletedItems.push.apply(l.deletedItems,t.deletedItems()),l.currentIds.push.apply(l.currentIds,r.pluck(t.items(),"id")),l.currentVersions.push.apply(l.currentVersions,r.pluck(t.items(),"version")),n().log("SynchedDataStore `"+t.name+"` synching with remote datastore "+i.remoteDataStore+"..."),i.remoteDataStore.synch(l).then(function(e){n().log("SynchedDataStore `"+t.name+"` synched with remote datastore. Processing response "+e+"...");var i,s,o,l;if(e.deletedIds.length){for(i=0;s=e.deletedIds[i];i++)o=r.indexOf(t.items(),s),-1!==o&&(t.items().splice(o,1),c=!0),o=r.indexOf(t.deletedItems(),s),-1!==o&&t.deletedItems().splice(o,1);n().log("Processed "+e.deletedIds.length+" deleted items.")}if(e.updatedItems.length){for(i=0;l=e.updatedItems[i];i++)if(o=r.indexOf(t.futureItems(),l),-1!==o){var d=t.futureItems().splice(o,1)[0];o=r.indexOf(t.updatedItems(),l),-1!==o?t.updatedItems().splice(o,1,l):t.updatedItems().push(l);var u=r.clone(l);for(var h in d)"version"!==h&&(u[h]=d[h]);o=r.indexOf(t.items(),l),-1!==o&&t.items().splice(o,1,u)}else o=r.indexOf(t.updatedItems(),l),-1!==o?t.updatedItems().splice(o,1):c=!0,o=r.indexOf(t.items(),l),-1!==o?t.items().splice(o,1,l):t.items().push(l);e.updatedItems.length&&n().log("Processed "+e.updatedItems.length+" updated items.")}if(e.createdItems.length){for(i=0;l=e.createdItems[i];i++)o=r.indexOf(t.items(),l),-1===o?(t.items().push(l),c=!0):t.items().splice(o,1,l);n().log("Processed "+e.createdItems.length+" created items.")}if(e.staleItems.length){for(i=0;l=e.staleItems[i];i++)o=r.indexOf(t.staleItems(),l),-1===o?t.staleItems().push(l):t.staleItems().splice(o,1,l),o=r.indexOf(t.createdItems(),l),-1!==o&&t.createdItems().splice(o,1),o=r.indexOf(t.updatedItems(),l),-1!==o&&t.updatedItems().splice(o,1),o=r.indexOf(t.deletedItems(),l),-1!==o&&t.deletedItems().splice(o,1);n().log("Processed "+e.staleItems.length+" stale items.")}if(e.failedItems.length){for(i=0;l=e.failedItems[i];i++)o=r.indexOf(t.failedItems(),l),-1===o?t.failedItems().push(l):t.failedItems().splice(o,1,l),-1!==r.indexOf(t.createdItems(),l)&&(o=r.indexOf(t.items(),l),-1!==o&&t.items().splice(o,1)),o=r.indexOf(t.updatedItems(),l),-1!==o&&t.updatedItems().splice(o,1),o=r.indexOf(t.deletedItems(),l),-1!==o&&t.deletedItems().splice(o,1);n().log("Processed "+e.failedItems.length+" failed items.")}t.lastSynched(new Date),t.synching=!1,n().log("SynchedDataStore `"+t.name+"` synched."),c&&(n().log("SynchedDataStore `"+t.name+"` changed. Triggering change..."),t.trigger("change")),n().log("SynchedDataStore `"+t.name+"` triggering success...."),t.trigger("synch:success"),a(),n().log("SynchedDataStore `"+t.name+"` triggering done...."),t.trigger("synch:done"),n().log("SynchedDataStore `"+t.name+"` synch done.")})["catch"](function(e){n().log("SynchedDataStore `"+t.name+"` synch error:"+e),t.synching=!1,t.synchError=e,t.trigger("synch:failed"),o(e),t.trigger("synch:done")})}catch(d){n().log("SynchedDataStore `"+t.name+"` synch error:"+d),t.synching=!1,t.synchError=d,t.trigger("synch:failed"),o(d),t.trigger("synch:done")}}):d(t))},isSynching:function(){return!!this.synching},load:function(e,t,n){var r=this;return new Promise(function(i,a){this.synch().then(function(){r.cfg.localDataStore.load(e,t,n).then(function(e){i(e)})})["catch"](function(e){a(e)})})},count:function(e){var t=this;return new Promise(function(n,r){this.synch().then(function(){t.cfg.localDataStore.count(e,pageSize,pageIndex).then(function(e){n(e)})["catch"](function(e){r(e)})})["catch"](function(e){r(e)})})},save:function(e){var t=this;return new Promise(function(n,r){t.cfg.localDataStore.save(e).then(function(e){t.synch().then(function(){n(e)})["catch"](function(e){r(e)})})["catch"](function(e){r(e)})})},"delete":function(e){var t=this;return new Promise(function(n,r){t.cfg.localDataStore["delete"](e).then(function(e){t.synch().then(function(){n(e)})["catch"](function(e){r(e)})})["catch"](function(e){r(e)})})},lastSynched:function(e){return this.cfg.localDataStore.lastSynched(e)},items:function(){return this.cfg.localDataStore.items()},createdItems:function(){return this.cfg.localDataStore.createdItems()},updatedItems:function(){return this.cfg.localDataStore.updatedItems()},deletedItems:function(){return this.cfg.localDataStore.deletedItems()},staleItems:function(){return this.cfg.localDataStore.staleItems()},failedItems:function(){return this.cfg.localDataStore.failedItems()},futureItems:function(){return this.cfg.localDataStore.futureItems()},set:function(e){return this.cfg.localDataStore.set(e)},del:function(e){return this.cfg.localDataStore.del(e)}});return i.registerType("synched",function(e,t,n){return new h(e,t,n)}),h}),define("bridalapp/brands",["bridalapp/class","bridalapp/syncheddatastore","bridalapp/rhaboodatastore","bridalapp/restdatastore"],function(e,t){var n=e("Brands",t,{initialize:function($super){$super("brands","synched://rhaboo/bridal-app/brands#http/api/brands")}});return new n}),define("bridalapp/category",["bridalapp/class","bridalapp/named"],function(e,t){var n=e("Category",t,{initialize:function($super,e){$super(e)}});return n}),define("bridalapp/credential",["bridalapp/class","bridalapp/persistent"],function(e,t){var n=e("Credential",t,{initialize:function($super,e){$super(e)}});return n}),define("bridalapp/group",["bridalapp/class","bridalapp/named"],function(e,t){var n=e("Group",t,{initialize:function($super,e){$super(e),this.description=e&&e.description||null}});return n}),define("bridalapp/password-credential",["bridalapp/class","bridalapp/credential"],function(e,t){var n=e("PasswordCredential",t,{initialize:function($super,e){$super(e),this.password=e&&e.password||null}});return n}),define("bridalapp/product",["bridalapp/class","bridalapp/named"],function(e,t){var n=e("Product",t,{initialize:function($super,e){$super(e),this.description=e&&e.description||null,this.priceWholesaleEuroCent=e&&e.priceWholesaleEuroCent||null,this.priceConsumerEuroCent=e&&e.priceConsumerEuroCent||null,this.brandId=e&&e.brandId||null,this.brandName=e&&e.brandName||null,this.categoryId=e&&e.categoryId||null,this.categoryName=e&&e.categoryName||null,this.tags=e&&e.tags||null}});return n}),define("bridalapp/products",["bridalapp/class","bridalapp/syncheddatastore","bridalapp/rhaboodatastore","bridalapp/restdatastore"],function(e,t){var n=e("Products",t,{initialize:function($super){$super("products","synched://rhaboo/bridal-app/products#http/api/products"),this.cfg.remoteDataStore.cfg.supportsSynch=!0}});return new n}),define("bridalapp/rating",["bridalapp/class","bridalapp/persistent"],function(e,t){var n=e("Rating",t,{initialize:function($super,e){$super(e),this.productId=e&&e.productId||null,this.accountId=e&&e.accountId||null,this.score=e&&e.score||null},toStringProperties:function($super){return $super()+" "+this.score+" "+this.productId}});return n}),define("bridalapp/ratings",["bridalapp/class","bridalapp/syncheddatastore","bridalapp/rhaboodatastore","bridalapp/restdatastore"],function(e,t){var n=e("Ratings",t,{initialize:function($super){$super("ratings","synched://rhaboo/bridal-app/ratings#http/api/ratings"),this.cfg.remoteDataStore.cfg.supportsSynch=!0}});return new n}),define("bridalapp/role",["bridalapp/class","bridalapp/named"],function(e,t){var n=e("Role",t,{initialize:function($super,e){$super(e)}});return n}),/*! 
[bridalapp-client 0.9.4](http://github.com/download/bridalapp-client). Copyright 2015 by [Stijn de Witt](http://StijnDeWitt.com). Some rights reserved. License: [CC-BY-4.0](https://creativecommons.org/licenses/by/4.0/) */
define("bridalapp",["bridalapp/rhaboodatastore","bridalapp/restdatastore","bridalapp/account","bridalapp/brand","bridalapp/brands","bridalapp/category","bridalapp/credential","bridalapp/group","bridalapp/log","bridalapp/named","bridalapp/password-credential","bridalapp/persistent","bridalapp/product","bridalapp/products","bridalapp/rating","bridalapp/ratings","bridalapp/role"],function(e,t,n,r,i,a,s,o,c,l,d,u,h,f,p,g,m){return{Account:n,Brand:r,Brands:i,Category:a,Credential:s,Group:o,log:c,Named:l,PasswordCredential:d,Persistent:u,Product:h,Products:f,Rating:p,Ratings:g,Role:m,globalize:function(e){for(var t in this)this.hasOwnProperty(t)&&(e[t]=this[t])}}});
//# sourceMappingURL=bridalapp.min.js
//# sourceMappingURL=bridalapp.min.js.map