define("bridalapp/class",[],function(){function Class(){var name="",parent=null,args=arrayify(arguments);("string"==typeof args[0]||args[0]instanceof String)&&(name=args.shift()),"function"==typeof args[0]&&(parent=args.shift());var classname=name||"klass";if(eval("var klass = function "+classname+"() {this.initialize.apply(this, arguments);}"),klass.classname=classname,klass.superclass=parent,klass.subclasses=[],parent){var subclass=function(){};subclass.prototype=parent.prototype,klass.prototype=new subclass,parent.subclasses.push(klass)}for(var i=0,len=args.length;len>i;i++)addMethods(klass,args[i]);return klass.prototype.initialize||(klass.prototype.initialize=function(){}),klass.prototype.constructor=klass,klass}function argumentNames(e){var t,a,n=e.toString().match(/^[\s\(]*function[^(]*\((.*?)\)/)[1].split(",");for(t=0,a=n.length;a>t;t++)n[t]=n[t].replace(/^\s+/,"").replace(/\s+$/,"");return 1!==a||n[0]?n:[]}function arrayify(e){if(!e)return[];if("toArray"in Object(e))return e.toArray();for(var t=e.length||0,a=new Array(t);t--;)a[t]=e[t];return a}function bind(e){if(arguments.length<3&&void 0===arguments[1])return e;var t=arrayify(arguments),a=t.splice(0,2)[1];return function(){return e.apply(a,t.concat(arrayify(arguments)))}}function wrap(e,t){return function(){return t.apply(this,[bind(e,this)].concat(arrayify(arguments)))}}function addMethods(e,t){function a(e){var t=[];for(var a in e)t.push(a);return t}for(var n,i=e.superclass&&e.superclass.prototype,r=a(t),s=0;n=r[s];s++){var o=t[n];if(i&&"function"==typeof o){var l=argumentNames(o);if(l.length>0&&"$super"===l[0]){var c=o;o=wrap(function(e){return function(){return i[e].apply(this,arguments)}}(n),c),o.valueOf=bind(c.valueOf,c),o.toString=bind(c.toString,c)}}e.prototype[n]=o}}return Class.subclass=function(e,t){if(e){if(e.classname===t)return e;for(var a,n=0;a=e.subclasses[n];n++){if(a.classname===t)return a;var i=Class.subclass(a,t);if(i)return i}}},Class}),define("bridalapp/log",[],function(){function e(){return i}var t,a,n=["log","info","warn","error"],i="console"in this&&console.error?console:{},r={},s={};for(t=0;a=n[t];t++)s[a]=function(){},r[a]=i[a]||s[a];e.level=function(e){if(void 0!==e&&e>=0&&4>=e&&e!==o){o=e;for(var t,a=0;t=n[a];a++)i[t]=a>=e?r[t]:s[t]}return o},e.level.DEBUG=0,e.level.INFO=1,e.level.WARN=2,e.level.ERROR=3,e.level.NONE=4;var o=e.level(e.level.INFO);return e}),define("bridalapp/datastore",["bridalapp/class"],function(e){"use strict";var t=e("DataStore",{initialize:function(e,t,a){this.name=e,this.url=t||"",this.cfg=a||{},this.cfg.listeners=this.cfg.listeners||{},this.cfg.throttle=this.cfg.throttle||{}},on:function(e,t){this.cfg.listeners[e]=this.cfg.listeners[e]||[],this.cfg.listeners[e].push(t)},trigger:function(e){var t=this,a=t.cfg,n=a.listeners[e];if(n){a.throttle[e]||(a.throttle[e]={triggered:Date.now()});var i=a.throttle[e];i.timeout&&Date.now()<i.triggered+250?clearTimeout(i.timeout):i.triggered=Date.now(),i.timeout=setTimeout(function(){for(var e,a=0;e=n[a];a++)e.call(t);i.timeout=null},10)}},off:function(e,t){if(this.cfg.listeners[e]){if(!t){var a=this.cfg.listeners[e];return delete this.cfg.listeners[e],a}for(var n=this.cfg.listeners[e].length-1;n>=0;n--)if(this.cfg.listeners[e][n]===t)return this.cfg.listeners[e].splice(n,1)}},load:function(){return new Promise(function(e){e([])})},count:function(){return new Promise(function(e){e(0)})},save:function(e){return new Promise(function(t){t(void 0===e.length?[e]:e)})},"delete":function(e){return new Promise(function(t){t("length"in e?e:[e])})},toString:function(){return"[Object "+this.constructor.classname+" '"+this.name+"' {url: '"+this.url+"'}]"}});return t.typeFactories={},t.registerType=function(e,a){t.typeFactories[e]||(t.typeFactories[e]=a)},t.fromType=function(e,a,n,i){return t.typeFactories[a](e,n,i)},t.fromUrl=function(e,a,n){if(!a)return null;var i=a.indexOf("://"),r=a.substring(0,i),s="https"===r?"http":r||"http";return t.fromType(e,s,a,n)},t}),define("bridalapp/synchabledatastore",["suid","bridalapp/class","bridalapp/datastore"],function(e,t,a){"use strict";var n=t("SynchableDataStore",a,{initialize:function($super,e,t,a){$super(e,t,a)},get:function(e,t,a,n){var i=n?Persistent.clone(this.items()):this.items();return Persistent.page(Persistent.matches(i,e),t,a)},len:function(e){return this.get(e).length},looksSynched:function(){return 0!==this.lastSynched().getTime()&&!(this.createdItems().length||this.updatedItems().length||this.deletedItems().length)},synch:function(){return new Promise(function(e){e()})},isSynching:function(){return!1},lastSynched:function(e){return e||new Date},items:function(){},createdItems:function(){return[]},updatedItems:function(){return[]},deletedItems:function(){return[]},staleItems:function(){return[]},failedItems:function(){return[]},futureItems:function(){return[]},set:function(e){return e},del:function(e){return e},toString:function($super){var e=$super();return e=e.substring(0,e.length-2),"[Object "+this.constructor.classname+" '"+this.name+"' {url: '"+this.url+"', lastSynched:"+this.lastSynched()+", items:"+this.items().length+", created:"+this.createdItems().length+", updated:"+this.updatedItems().length+", deleted:"+this.deletedItems().length+", stale:"+this.staleItems().length+", failed:"+this.failedItems().length+"}]"}});return n}),define("bridalapp/persistent",["bridalapp/class","suid"],function(e,t){var a=e("Persistent",{initialize:function(e){this.type=this.constructor.classname,this.id=t(0),this.version=null;for(var a in e)"function"!=typeof a&&this.addProp(a,e[a])},addProp:function(e,t,a){(void 0!==t||void 0!==a)&&(this[e]=void 0!==t?t:a)},equals:function(e){return e&&(e instanceof a&&e.id.value===this.id.value||e instanceof t&&e.value===this.id.value||e==this.id.value)},toString:function(){return"[Object "+this.type+" "+this.toStringProperties()+"]"},toStringProperties:function(){return this.id.toString()+" v"+this.version}});return a.revive=function(n,i){var r=i&&"object"==typeof i&&"string"==typeof i.type&&i.type,s=e.subclass(a,r);return s?new s(i):t.revive(n,i)},a.fromJSON=function(e){return JSON.parse(e,a.revive)},a.persistent=function(e){if(1===arguments.length)return e instanceof a&&null!==e.version;for(var t=[],n=0;e=arguments[n];n++)if(a.persistent(e))t.push(e);else if("length"in e)for(var i,r=0;i=e[r];r++)a.persistent(i)&&t.push(i);return t},a.equals=function(e,t,a){return e==t||a&&0===a(e,t)||e&&e.equals&&e.equals(t)||t&&t.equals&&t.equals(e)||"object"==typeof e&&e&&e.valueOf()==t||"object"==typeof t&&t&&t.valueOf()==e},a.indexOf=function(e,t){for(var n,i=0;n=e[i];i++)if(a.equals(n,t))return i;return-1},a.matches=function(e,t){var n=Array.prototype.concat.call(e||[]);if(t)for(var i=n.length-1;i>=0;i--)for(var r in t)if(t.hasOwnProperty(r))if(Array.isArray&&Array.isArray(t[r])||t[r]instanceof Array){if(-1===a.indexOf(t[r],e[i][r])){n.splice(i,1);break}}else if(!a.equals(e[i][r],t[r])){n.splice(i,1);break}return n},a.pluck=function(e,t){for(var a,n=[],i=0;a=e[i];i++)void 0!==a[t]&&n.push(a[t]);return n},a.clone=function(e){var t=[];if(arguments.length>1)return a.clone(arguments);if(!("length"in e))return e instanceof a&&e.clone?e.clone():a.fromJSON(JSON.stringify(e));for(var n,t=[],i=0;n=e[i];i++)t.push(a.clone(n));return t},a.page=function(e,t,a){if(t){var n=(a||0)*t,i=a*(t+1);return 0>i||n>=i||n>e.length?[]:e.slice(Math.max(n,0),Math.min(i,e.length))}return e},a.eachArg=function(e,t,n){if("length"in e&&!(e instanceof a)){for(var i,r=[],s=0;i=e[s];s++)r.push.apply(r,a.eachArg(i,t,n));return r}return n.call(t,e)},a}),define("bridalapp/localdatastore",["bridalapp/class","bridalapp/log","bridalapp/datastore","bridalapp/synchabledatastore","bridalapp/persistent","memorystorage"],function(e,t,a,n,i,r){"use strict";var s=e("LocalDataStore",n,{initialize:function($super,e,a,n){if(t().log("Initializing LocalDataStore `"+e+"`..."),$super(e,a,n),!this.cfg.local||!this.cfg.store){var i=a.indexOf("://")+3,r=a.lastIndexOf("/"),s=a.substring(i,r),o=a.substring(r+1);this.cfg.repo||(this.cfg.repo=s),this.cfg.store||(this.cfg.store=o)}t().log("Initialized LocalDataStore `"+e+"`.")},load:function(e,a,n){t().log("Loading LocalDataStore `"+name+"`...");var i=this;return new Promise(function(r){r(i.get(e,a,n)),t().log("Loaded LocalDataStore `"+name+"`.")})},count:function(e){t().log("LocalDataStore `"+name+"` count() starting (criteria="+e+")...");var a=this;return new Promise(function(e){e(a.len()),t().log("LocalDataStore `"+name+"` count() done: "+a.len()+".")})},save:function(e){t().log("LocalDataStore `"+name+"` save() starting (item="+e+")...");var a=this;return new Promise(function(n){n(a.set(e)),t().log("LocalDataStore `"+name+"` save() done.")})},"delete":function(e){t().log("LocalDataStore `"+name+"` delete() starting (item="+e+")...");var a=this;return new Promise(function(n){n(a.del(e)),t().log("LocalDataStore `"+name+"` delete() done.")})},set:function(e){t().log("LocalDataStore `"+name+"` set() starting (item="+e+")...");var a=i.eachArg(arguments,this,function(e){var t=null,a=i.indexOf(this.db().items,e);return-1===a?this.db().items.push(e):t=this.db().items.splice(a,1,e)[0],a=i.indexOf(this.db().deleted,e),-1!==a&&(t=this.db().deleted.splice(a,1)),t&&(a=i.indexOf(this.db().updated,e),-1===a?this.db().updated.push(t):this.synching&&(a=i.indexOf(this.db().future,e),-1===a?this.db().future.push(e):this.db().future.splice(a,1,e))),[e]});return t().log("LocalDataStore `"+name+"` set(): triggering change event."),this.trigger("change"),t().log("LocalDataStore `"+name+"` set(): done."),a},del:function(e){t().log("LocalDataStore `"+name+"` del() starting (item="+e+")...");var a=i.eachArg(arguments,this,function(e){var t,a=i.indexOf(this.items(),e);if(-1!==a&&(t=this.items().splice(a,1)[0]),i.persistent(e)){if(a=i.indexOf(this.db().updated,e),-1!==a){var n=this.db().updated.splice(a,1);t=t||n}a=i.indexOf(this.db().future,e),-1!==a&&this.db().future.splice(a,1),a=i.indexOf(this.db().deleted,e),-1===a&&this.db().deleted.push(t||e)}return[t||e]});return t().log("LocalDataStore `"+name+"` del(): triggering change event."),this.trigger("change"),t().log("LocalDataStore `"+name+"` del(): done."),a},lastSynched:function(e){return e&&(this.db().lastSynched=e),this.db().lastSynched},items:function(){return this.db().items},createdItems:function(){for(var e,t=[],a=0;e=this.items()[a];a++)i.persistent(e)||t.push(e);return t},updatedItems:function(){return this.db().updated},deletedItems:function(){return this.db().deleted},staleItems:function(){return this.db().stale},failedItems:function(){return this.db().failed},futureItems:function(){return this.db().future},db:function(){if(!this.cfg.local){this.cfg.local=new r(this.cfg.repo),this.cfg.local[this.cfg.store]||(this.cfg.local[this.cfg.store]={});for(var e,t=0;e=["items","updated","deleted","stale","failed","future"][t];t++)this.db()[e]||(this.db()[e]=[]);this.db().lastSynched||(this.db().lastSynched=new Date(0))}return this.cfg.local[this.cfg.store]}});return a.registerType("local",function(e,t,a){return new s(e,t,a)}),s}),define("bridalapp/restdatastore",["bridalapp/class","jquery","bridalapp/log","bridalapp/persistent","bridalapp/datastore"],function(e,t,a,n,i){"use strict";function r(e,t,a){return new s(e,t,a)}var s=e("RestDataStore",i,{initialize:function($super,e,t,a){$super(e,t,a),this.cfg.retryCount=this.cfg.retryCount||0,this.cfg.retryWaitTime=this.cfg.retryWaitTime||2e3,this.cfg.timeout=this.cfg.timeout||1e4,void 0===this.cfg.supportsSynch&&(this.cfg.supportsSynch=!1)},load:function(e,t,a){return this.remoteRequest("GET",this.url,{criteria:e,pageSize:t,pageIndex:a})},count:function(e){return new Promise(function(t,a){this.remoteRequest("GET",this.url,{criteria:e}).then(function(e){t(e.length)})["catch"](function(e){a(e)})})},save:function(e){var t=n.eachArg(e,this,function(e){return[e]});return this.remoteRequest("POST",this.url+"/save",t)},"delete":function(e){var t=n.eachArg(e,this,function(e){return[e]});return this.remoteRequest("DELETE",this.url,t)},synch:function(e){return this.remoteRequest("POST",this.url+"/synch",e)},remoteRequest:function(e,i,r){return function(e,i,r,s,o){function l(e){var t="";if(e)if(e.length)t="("+e.length+" items)";else if(e.createdItems){var a=[];e.createdItems.length&&a.push(e.createdItems.length+" created"),e.updatedItems.length&&a.push(e.updatedItems.length+" updated"),e.deletedItems&&e.deletedItems.length&&a.push(e.deletedItems.length+" deleted"),e.deletedIds&&e.deletedIds.length&&a.push(e.deletedIds.length+" deleted"),a.length&&(t="("+a.join(", ")+")")}return t}function c(e,i,r,c,d,u){for(var f="",p=0;p<6-e.length;p++)f+=" ";a().log(" -> "+f+e+" "+i+" "+l(r)),t.ajax(i,{method:e,contentType:"application/json",processData:!1,data:r&&JSON.stringify(r),timeout:s}).done(function(t,r,s){-1!==s.responseText.indexOf("j_security_check")?(a().info("401 "+f+e+" "+i+" "+l(t)+" (LOGIN CHALLENGE)"),c(s,e,i,t,d,u)):(a().info("200 "+f+e+" "+i+" "+l(t)+" (OK)"),o=0,d(n.fromJSON(s.responseText)))}).fail(function(t,n,s){t.statusText=s||n,a().warn(t.status+" "+f+e+" "+i+" "+l(r)+" ("+t.statusText+")"),c(t,e,i,r,d,u)})}function d(e,t,a,n,i,r){var s=e.statusText;switch(status){case 500:case 502:case 503:case 504:if(o>0){u(e,t,a,n,errorHandler,i,r);break}case 200:200==e.status&&(s="Session expired.");default:o=0;var l=new Error(e.status+" "+s);l.status=e.status,l.statusText=s,l.request=e,l.method=t,l.url=a,l.data=n,r(l)}}function u(e,t,a,n,i,r,s){o--;var l=3e3,d=e.getResponseHeader("Retry-After");if(d){var u=parseInt(d,10);isNaN(u)||(l=1e3*u)}setTimeout(function(){c(t,a,n,errorhandler,r,s)},l)}Date.now();return new Promise(function(t,a){if("GET"===e&&r){var n=i.indexOf("#"),s=-1!==n?i.substring(n):"",o=i.indexOf("?"),l=-1!==o?i.substring(o):"";if(r.criteria)for(var u in r.criteria)r.criteria.hasOwnProperty(u)&&(l+=(l?"&":"")+encodeURIComponent(u)+"="+encodeURIComponent(r.criteria[u].toString()));r.pageSize&&(l+=(l?"&":"")+"pg="+r.pageIndex+"&pgsz="+r.pageSize),i=i+l+s,r=void 0}c(e,i,r,d,t,a)})}(e,i,r,this.cfg.timeout,this.cfg.retryCount,this.cfg.retryWaitTime)}});return i.registerType("http",r),i.registerType("https",r),s}),define("bridalapp/named",["bridalapp/class","bridalapp/persistent"],function(e,t){var a=e("Named",t,{initialize:function($super,e){this.name="",$super(e)},toString:function(){return"[Object "+this.type+" '"+this.name+"' "+this.id.toString()+" v"+this.version+"]"}});return a}),define("bridalapp/account",["bridalapp/class","bridalapp/persistent","bridalapp/named"],function(e,t,a){var n=e("Account",a,{initialize:function($super,e){this.roles=[],this.groups=[],this.credentials=[],$super(e)},is:function(e){return-1!==t.indexOf(this.roles,e)},isAny:function(e){for(var t,a=0;t=e[a];a++)if(this.is(t))return!0;return!1},isAll:function(e){for(var t,a=0;t=e[a];a++)if(!this.is(t))return!1;return!0}});return n}),define("bridalapp/brand",["bridalapp/class","bridalapp/named"],function(e,t){var a=e("Brand",t,{initialize:function($super,e){$super(e)}});return a}),define("bridalapp/synchrequest",["bridalapp/class"],function(e){var t=e("SynchRequest",{initialize:function(e){this.unsynchedDuration=e&&e.synchDuration||0,this.criteria=e&&e.criteria||null,this.currentIds=e&&e.currentIds||[],this.currentVersions=e&&e.currentVersions||[],this.createdItems=e&&e.createdItems||[],this.updatedItems=e&&e.updatedItems||[],this.deletedItems=e&&e.deletedItems||[]}});return t}),define("bridalapp/synchresponse",["bridalapp/class"],function(e){var t=e("SynchResponse",{initialize:function(e){this.createdItems=e&&e.createdItems||[],this.updatedItems=e&&e.updatedItems||[],this.staleItems=e&&e.staleItems||[],this.failedItems=e&&e.failedItems||[],this.deletedIds=e&&e.deletedIds||[]}});return t}),define("bridalapp/syncheddatastore",["bridalapp/class","jquery","bridalapp/log","bridalapp/persistent","bridalapp/datastore","bridalapp/synchabledatastore","bridalapp/synchrequest","bridalapp/synchresponse"],function(e,t,a,n,i,r,s){"use strict";function o(e,t){for(var a,i,r,s=!1,o=0;a=t[o];o++)r=n.indexOf(e.items(),a),-1===r?(r=n.indexOf(e.deletedItems(),a),-1!==r?a.version!==e.deletedItems()[r].version&&(e.deletedItems().splice(r,1),e.items().push(a)):e.items().push(a),s=!0):a.version!==e.items()[r].version&&(i=e.items().splice(r,1,a)[0],r=n.indexOf(e.updatedItems(),i),-1!==r&&(e.updatedItems().splice(r,1),r=n.indexOf(e.staleItems(),i),-1===r?e.staleItems().push(i):e.staleItems().splice(r,1,i)),s=!0);for(var o=e.items().length-1;o>=0;o--)if(a=e.items()[o],-1===n.indexOf(t,a)&&-1===n.indexOf(e.createdItems(),a)){var i=e.items().splice(o,1)[0];r=n.indexOf(e.updatedItems(),i),-1!==r&&(this.updatedItems().splice(r,1),r=n.indexOf(e.staleItems(),i),-1===staleIdx?e.staleItems().push(i):e.staleItems().splice(r,1,i)),s=!0}s&&e.trigger("change")}function l(e,t){for(var a,i=0;a=t[i];i++){var r=n.indexOf(e.futureItems(),a);if(-1!==r){var s=e.futureItems().splice(r,1)[0];r=n.indexOf(e.updatedItems(),a),-1!==r?e.updatedItems().splice(r,1,a):e.updatedItems().push(a);var o=n.clone(a);for(var l in s)"version"!==l&&(o[l]=s[l]);r=n.indexOf(e.items(),a),-1!==r&&e.items().splice(r,1,o)}else r=n.indexOf(e.updatedItems(),a),-1!==r&&e.updatedItems().splice(r,1),r=n.indexOf(e.items(),a),-1!==r&&e.items().splice(r,1,a)}}function c(e,t){for(var a,i=0;a=t[i];i++){var r=n.indexOf(e.deletedItems(),a);-1!==r&&e.deletedItems().splice(r,1)}}function d(e){var t=e.cfg;return e.synching=new Promise(function(a,i){return e.looksSynched()&&Date.now()<e.lastSynched().getTime()+t.pollInterval?setTimeout(function(){e.synching=!1,a()},0):(e.trigger("synch:started"),void t.remoteDataStore.load().then(function(r){o(e,r);for(var s,d=e.createdItems().concat(),u=0;s=e.updatedItems()[u];u++){var f=n.indexOf(e.items(),s);-1!==f&&d.push(e.items()[f])}var p=e.deletedItems().concat();new Promise(function(a,n){return p.length?void t.remoteDataStore["delete"](p).then(function(t){c(e,t),a()})["catch"](function(e){n(e)}):void a()}).then(function(){new Promise(function(a,n){return d.length?void t.remoteDataStore.save(d).then(function(t){l(e,t),a()})["catch"](function(e){n(e)}):void a()}).then(function(){e.lastSynched(new Date),e.synching=!1,e.synchError=!1,e.trigger("synch:success"),a(),e.trigger("synch:done")})["catch"](function(e){i(e)})})["catch"](function(e){i(e)})})["catch"](function(t){e.synching=!1,e.synchError=t,e.trigger("synch:failed"),i(t),e.trigger("synch:done")}))})}function u(e){e.autoSynchActive||(e.autoSynchActive=!0,setInterval(function(){e.synch()},e.cfg.synchInterval))}var f=e("SynchedDataStore",r,{initialize:function($super,e,t,n){if(a().log("Initializing SynchedDataStore `"+e+"`..."),$super(e,t,n),this.synching=!1,this.synchError=!1,n=this.cfg,void 0===n.autoSynch&&(n.autoSynch=!0),n.synchInterval||(n.synchInterval=15e3),n.pollInterval||(n.pollInterval=9e5),void 0===n.remoteSynch&&(n.remoteSynch=!0),!n.localDataStore||!n.remoteDataStore){var s=t.split("://")[1].split("#");if(!n.localDataStore){var o=s[0].split("/"),l=o[0],c=o.slice(1,o.length-1).join("/"),d=o[o.length-1];n.localDataStore=i.fromType(e,l,l+"://"+c+"/"+d),n.localDataStore instanceof r||a().error(n.localDataStore?"Unable to initialize SynchedDataStore '"+e+"'.Need a synchable datastore for the local side, but "+n.localDataStore+" is not a SynchableDataStore.":"Unable to initialize SynchedDataStore '"+e+"'.Need a synchable datastore for the local side, but could not find a datastore for url '"+s[0]+"'.")}if(!n.remoteDataStore){var u=s[1].split("/"),f=u[0],p=u.slice(1,u.length-1).join("/"),h=u[u.length-1];n.remoteDataStore=i.fromType(e,f,"/"+p+"/"+h),n.remoteDataStore||a().error("Unable to initialize SynchedDataStore '"+e+"'.Need a datastore for the remote side, but could not find a datastore for url '"+s[1]+"'.")}}a().log("Initialized SynchedDataStore `"+e+"`.")},synch:function($super,e){this.cfg.autoSynch&&u(this);var t=this,i=t.cfg;return t.synching?t.synching:(t.synchError=!1,i.remoteDataStore.cfg.supportsSynch?t.synching=new Promise(function(r,o){if(!e&&t.looksSynched()&&Date.now()<t.lastSynched().getTime()+i.pollInterval)return setTimeout(function(){t.synching=!1,r()},0);try{a().log("Synching SynchedDataStore `"+t.name+"`..."),t.trigger("synch:started");var l=!1,c=new s;c.criteria=i.filter||null,c.createdItems.push.apply(c.createdItems,t.createdItems()),c.updatedItems.push.apply(c.updatedItems,t.updatedItems()),c.deletedItems.push.apply(c.deletedItems,t.deletedItems()),c.currentIds.push.apply(c.currentIds,n.pluck(t.items(),"id")),c.currentVersions.push.apply(c.currentVersions,n.pluck(t.items(),"version")),a().log("SynchedDataStore `"+t.name+"` synching with remote datastore "+i.remoteDataStore+"..."),i.remoteDataStore.synch(c).then(function(e){a().log("SynchedDataStore `"+t.name+"` synched with remote datastore. Processing response "+e+"...");var i,s,o,c;if(e.deletedIds.length){for(i=0;s=e.deletedIds[i];i++)o=n.indexOf(t.items(),s),-1!==o&&(t.items().splice(o,1),l=!0),o=n.indexOf(t.deletedItems(),s),-1!==o&&t.deletedItems().splice(o,1);a().log("Processed "+e.deletedIds.length+" deleted items.")}if(e.updatedItems.length){for(i=0;c=e.updatedItems[i];i++)if(o=n.indexOf(t.futureItems(),c),-1!==o){var d=t.futureItems().splice(o,1)[0];o=n.indexOf(t.updatedItems(),c),-1!==o?t.updatedItems().splice(o,1,c):t.updatedItems().push(c);var u=n.clone(c);for(var f in d)"version"!==f&&(u[f]=d[f]);o=n.indexOf(t.items(),c),-1!==o&&t.items().splice(o,1,u)}else o=n.indexOf(t.updatedItems(),c),-1!==o?t.updatedItems().splice(o,1):l=!0,o=n.indexOf(t.items(),c),-1!==o?t.items().splice(o,1,c):t.items().push(c);e.updatedItems.length&&a().log("Processed "+e.updatedItems.length+" updated items.")}if(e.createdItems.length){for(i=0;c=e.createdItems[i];i++)o=n.indexOf(t.items(),c),-1===o?(t.items().push(c),l=!0):t.items().splice(o,1,c);a().log("Processed "+e.createdItems.length+" created items.")}if(e.staleItems.length){for(i=0;c=e.staleItems[i];i++)o=n.indexOf(t.staleItems(),c),-1===o?t.staleItems().push(c):t.staleItems().splice(o,1,c),o=n.indexOf(t.createdItems(),c),-1!==o&&t.createdItems().splice(o,1),o=n.indexOf(t.updatedItems(),c),-1!==o&&t.updatedItems().splice(o,1),o=n.indexOf(t.deletedItems(),c),-1!==o&&t.deletedItems().splice(o,1);a().log("Processed "+e.staleItems.length+" stale items.")}if(e.failedItems.length){for(i=0;c=e.failedItems[i];i++)o=n.indexOf(t.failedItems(),c),-1===o?t.failedItems().push(c):t.failedItems().splice(o,1,c),-1!==n.indexOf(t.createdItems(),c)&&(o=n.indexOf(t.items(),c),-1!==o&&t.items().splice(o,1)),o=n.indexOf(t.updatedItems(),c),-1!==o&&t.updatedItems().splice(o,1),o=n.indexOf(t.deletedItems(),c),-1!==o&&t.deletedItems().splice(o,1);a().log("Processed "+e.failedItems.length+" failed items.")}t.lastSynched(new Date),t.synching=!1,a().log("SynchedDataStore `"+t.name+"` synched."),l&&(a().log("SynchedDataStore `"+t.name+"` changed. Triggering change..."),t.trigger("change")),a().log("SynchedDataStore `"+t.name+"` triggering success...."),t.trigger("synch:success"),r(),a().log("SynchedDataStore `"+t.name+"` triggering done...."),t.trigger("synch:done"),a().log("SynchedDataStore `"+t.name+"` synch done.")})["catch"](function(e){a().log("SynchedDataStore `"+t.name+"` synch error:"+e),t.synching=!1,t.synchError=e,t.trigger("synch:failed"),o(e),t.trigger("synch:done")})}catch(d){a().log("SynchedDataStore `"+t.name+"` synch error:"+d),t.synching=!1,t.synchError=d,t.trigger("synch:failed"),o(d),t.trigger("synch:done")}}):d(t))},isSynching:function(){return!!this.synching},load:function(e,t,a){var n=this;return new Promise(function(i,r){this.synch().then(function(){n.cfg.localDataStore.load(e,t,a).then(function(e){i(e)})})["catch"](function(e){r(e)})})},count:function(e){var t=this;return new Promise(function(a,n){this.synch().then(function(){t.cfg.localDataStore.count(e,pageSize,pageIndex).then(function(e){a(e)})["catch"](function(e){n(e)})})["catch"](function(e){n(e)})})},save:function(e){var t=this;return new Promise(function(a,n){t.cfg.localDataStore.save(e).then(function(e){t.synch().then(function(){a(e)})["catch"](function(e){n(e)})})["catch"](function(e){n(e)})})},"delete":function(e){var t=this;return new Promise(function(a,n){t.cfg.localDataStore["delete"](e).then(function(e){t.synch().then(function(){a(e)})["catch"](function(e){n(e)})})["catch"](function(e){n(e)})})},lastSynched:function(e){return this.cfg.localDataStore.lastSynched(e)},items:function(){return this.cfg.localDataStore.items()},createdItems:function(){return this.cfg.localDataStore.createdItems()},updatedItems:function(){return this.cfg.localDataStore.updatedItems()},deletedItems:function(){return this.cfg.localDataStore.deletedItems()},staleItems:function(){return this.cfg.localDataStore.staleItems()},failedItems:function(){return this.cfg.localDataStore.failedItems()},futureItems:function(){return this.cfg.localDataStore.futureItems()},set:function(e){return this.cfg.localDataStore.set(e)},del:function(e){return this.cfg.localDataStore.del(e)}});return i.registerType("synched",function(e,t,a){return new f(e,t,a)}),f}),define("bridalapp/brands",["bridalapp/class","bridalapp/syncheddatastore","bridalapp/localdatastore","bridalapp/restdatastore"],function(e,t){var a=e("Brands",t,{initialize:function($super){$super("brands","synched://local/bridal-app/brands#http/api/brands")}});return new a}),define("bridalapp/category",["bridalapp/class","bridalapp/named"],function(e,t){var a=e("Category",t,{initialize:function($super,e){$super(e)}});return a}),define("bridalapp/country",["bridalapp/class"],function(e){var t=e("Country",{initialize:function(e,t){"object"==typeof e&&(t=e.code,e=e.name),this.name=e,this.code=t}});return t}),define("bridalapp/countries",["bridalapp/class","bridalapp/country"],function(e,t){var a=e("Countries",{initialize:function(){this.items=[];for(var e,a=[["AF","Afghanistan"],["AX","Åland Islands"],["AL","Albania"],["DZ","Algeria"],["AS","American Samoa"],["AD","Andorra"],["AO","Angola"],["AI","Anguilla"],["AQ","Antarctica"],["AG","Antigua and Barbuda"],["AR","Argentina"],["AM","Armenia"],["AW","Aruba"],["AU","Australia"],["AT","Austria"],["AZ","Azerbaijan"],["BS","Bahamas"],["BH","Bahrain"],["BD","Bangladesh"],["BB","Barbados"],["BY","Belarus"],["BE","Belgium"],["BZ","Belize"],["BJ","Benin"],["BM","Bermuda"],["BT","Bhutan"],["BO","Bolivia (Plurinational State of)"],["BQ","Bonaire, Sint Eustatius and Saba"],["BA","Bosnia and Herzegovina"],["BW","Botswana"],["BV","Bouvet Island"],["BR","Brazil"],["IO","British Indian Ocean Territory"],["BN","Brunei Darussalam"],["BG","Bulgaria"],["BF","Burkina Faso"],["BI","Burundi"],["KH","Cambodia"],["CM","Cameroon"],["CA","Canada"],["CV","Cabo Verde"],["KY","Cayman Islands"],["CF","Central African Republic"],["TD","Chad"],["CL","Chile"],["CN","China"],["CX","Christmas Island"],["CC","Cocos (Keeling) Islands"],["CO","Colombia"],["KM","Comoros"],["CG","Congo"],["CD","Congo (Democratic Republic of the)"],["CK","Cook Islands"],["CR","Costa Rica"],["CI","Côte d`Ivoire"],["HR","Croatia"],["CU","Cuba"],["CW","Curaçao"],["CY","Cyprus"],["CZ","Czech Republic"],["DK","Denmark"],["DJ","Djibouti"],["DM","Dominica"],["DO","Dominican Republic"],["EC","Ecuador"],["EG","Egypt"],["SV","El Salvador"],["GQ","Equatorial Guinea"],["ER","Eritrea"],["EE","Estonia"],["ET","Ethiopia"],["FK","Falkland Islands (Malvinas)"],["FO","Faroe Islands"],["FJ","Fiji"],["FI","Finland"],["FR","France"],["GF","French Guiana"],["PF","French Polynesia"],["TF","French Southern Territories"],["GA","Gabon"],["GM","Gambia"],["GE","Georgia"],["DE","Germany"],["GH","Ghana"],["GI","Gibraltar"],["GR","Greece"],["GL","Greenland"],["GD","Grenada"],["GP","Guadeloupe"],["GU","Guam"],["GT","Guatemala"],["GG","Guernsey"],["GN","Guinea"],["GW","Guinea-Bissau"],["GY","Guyana"],["HT","Haiti"],["HM","Heard Island and McDonald Islands"],["VA","Holy See"],["HN","Honduras"],["HK","Hong Kong"],["HU","Hungary"],["IS","Iceland"],["IN","India"],["ID","Indonesia"],["IR","Iran (Islamic Republic of)"],["IQ","Iraq"],["IE","Ireland"],["IM","Isle of Man"],["IL","Israel"],["IT","Italy"],["JM","Jamaica"],["JP","Japan"],["JE","Jersey"],["JO","Jordan"],["KZ","Kazakhstan"],["KE","Kenya"],["KI","Kiribati"],["KP","Korea (Democratic People`s Republic of)"],["KR","Korea (Republic of)"],["KW","Kuwait"],["KG","Kyrgyzstan"],["LA","Lao People`s Democratic Republic"],["LV","Latvia"],["LB","Lebanon"],["LS","Lesotho"],["LR","Liberia"],["LY","Libya"],["LI","Liechtenstein"],["LT","Lithuania"],["LU","Luxembourg"],["MO","Macao"],["MK","Macedonia (the former Yugoslav Republic of)"],["MG","Madagascar"],["MW","Malawi"],["MY","Malaysia"],["MV","Maldives"],["ML","Mali"],["MT","Malta"],["MH","Marshall Islands"],["MQ","Martinique"],["MR","Mauritania"],["MU","Mauritius"],["YT","Mayotte"],["MX","Mexico"],["FM","Micronesia (Federated States of)"],["MD","Moldova (Republic of)"],["MC","Monaco"],["MN","Mongolia"],["ME","Montenegro"],["MS","Montserrat"],["MA","Morocco"],["MZ","Mozambique"],["MM","Myanmar"],["NA","Namibia"],["NR","Nauru"],["NP","Nepal"],["NL","Netherlands"],["NC","New Caledonia"],["NZ","New Zealand"],["NI","Nicaragua"],["NE","Niger"],["NG","Nigeria"],["NU","Niue"],["NF","Norfolk Island"],["MP","Northern Mariana Islands"],["NO","Norway"],["OM","Oman"],["PK","Pakistan"],["PW","Palau"],["PS","Palestine, State of"],["PA","Panama"],["PG","Papua New Guinea"],["PY","Paraguay"],["PE","Peru"],["PH","Philippines"],["PN","Pitcairn"],["PL","Poland"],["PT","Portugal"],["PR","Puerto Rico"],["QA","Qatar"],["RE","Réunion"],["RO","Romania"],["RU","Russian Federation"],["RW","Rwanda"],["BL","Saint Barthélemy"],["SH","Saint Helena, Ascension and Tristan da Cunha"],["KN","Saint Kitts and Nevis"],["LC","Saint Lucia"],["MF","Saint Martin (French part)"],["PM","Saint Pierre and Miquelon"],["VC","Saint Vincent and the Grenadines"],["WS","Samoa"],["SM","San Marino"],["ST","Sao Tome and Principe"],["SA","Saudi Arabia"],["SN","Senegal"],["RS","Serbia"],["SC","Seychelles"],["SL","Sierra Leone"],["SG","Singapore"],["SX","Sint Maarten (Dutch part)"],["SK","Slovakia"],["SI","Slovenia"],["SB","Solomon Islands"],["SO","Somalia"],["ZA","South Africa"],["GS","South Georgia and the South Sandwich Islands"],["SS","South Sudan"],["ES","Spain"],["LK","Sri Lanka"],["SD","Sudan"],["SR","Suriname"],["SJ","Svalbard and Jan Mayen"],["SZ","Swaziland"],["SE","Sweden"],["CH","Switzerland"],["SY","Syrian Arab Republic"],["TW","Taiwan, Province of China"],["TJ","Tajikistan"],["TZ","Tanzania, United Republic of"],["TH","Thailand"],["TL","Timor-Leste"],["TG","Togo"],["TK","Tokelau"],["TO","Tonga"],["TT","Trinidad and Tobago"],["TN","Tunisia"],["TR","Turkey"],["TM","Turkmenistan"],["TC","Turks and Caicos Islands"],["TV","Tuvalu"],["UG","Uganda"],["UA","Ukraine"],["AE","United Arab Emirates"],["GB","United Kingdom of Great Britain and Northern Ireland"],["US","United States of America"],["UM","United States Minor Outlying Islands"],["UY","Uruguay"],["UZ","Uzbekistan"],["VU","Vanuatu"],["VE","Venezuela (Bolivarian Republic of)"],["VN","Viet Nam"],["VG","Virgin Islands (British)"],["VI","Virgin Islands (U.S.)"],["WF","Wallis and Futuna"],["EH","Western Sahara"],["YE","Yemen"],["ZM","Zambia"],["ZW","Zimbabwe"]],n=0;e=a[n];n++)this.items.push(new t(e[1],e[0]))},get:function(){return this.items},by:function(e,t,a){var n=[],i=0;if(!this.items.length)return n;for("string"!=typeof t||a||(t=t.toLowerCase());i<this.items.length;){var r=this.items[i][e];if("string"==typeof r&&(a||(r=r.toLowerCase()),0===r.indexOf(t)))break;if(r===t)break;i++}for(;i<this.items.length;){var r=this.items[i][e];if("string"==typeof r){if(a||(r=r.toLowerCase()),0!==r.indexOf(t))break;n.push(this.items[i])}else{if(r!==t)break;n.push(this.items[i])}i++}return n},byCode:function(e){return this.by("code",e)},byName:function(e){return this.by("name",e)}});return new a}),define("bridalapp/credential",["bridalapp/class","bridalapp/persistent"],function(e,t){var a=e("Credential",t,{initialize:function($super,e){$super(e)}});return a}),define("bridalapp/group",["bridalapp/class","bridalapp/named"],function(e,t){var a=e("Group",t,{initialize:function($super,e){$super(e)
}});return a}),define("bridalapp/password-credential",["bridalapp/class","bridalapp/credential"],function(e,t){var a=e("PasswordCredential",t,{initialize:function($super,e){$super(e)}});return a}),define("bridalapp/product",["bridalapp/class","bridalapp/named"],function(e,t){var a=e("Product",t,{initialize:function($super,e){$super(e)}});return a}),define("bridalapp/products",["bridalapp/class","bridalapp/syncheddatastore","bridalapp/localdatastore","bridalapp/restdatastore"],function(e,t){var a=e("Products",t,{initialize:function($super){$super("products","synched://local/bridal-app/products#http/api/products"),this.cfg.remoteDataStore.cfg.supportsSynch=!0}});return new a}),define("bridalapp/rating",["bridalapp/class","bridalapp/persistent"],function(e,t){var a=e("Rating",t,{initialize:function($super,e){$super(e)},toStringProperties:function($super){return $super()+" "+this.score+" "+this.productId}});return a}),define("bridalapp/ratings",["bridalapp/class","bridalapp/syncheddatastore","bridalapp/localdatastore","bridalapp/restdatastore"],function(e,t){var a=e("Ratings",t,{initialize:function($super){$super("ratings","synched://local/bridal-app/ratings#http/api/ratings"),this.cfg.remoteDataStore.cfg.supportsSynch=!0}});return new a}),define("bridalapp/role",["bridalapp/class","bridalapp/named","suid"],function(e,t,a){var n=e("Role",t,{initialize:function($super,e){$super(e)}});return n.GUEST=new n({id:a(1),name:"Guest"}),n.USER=new n({id:a(2),name:"User"}),n.STORE_USER=new n({id:a(3),name:"Store-User"}),n.STORE_MANAGER=new n({id:a(4),name:"Store-Manager"}),n.BRAND_USER=new n({id:a(5),name:"Brand-User"}),n.BRAND_MANAGER=new n({id:a(6),name:"Brand-Manager"}),n.BRAUTSCHLOSS_USER=new n({id:a(7),name:"Brautschloss-User"}),n.BRAUTSCHLOSS_MANAGER=new n({id:a(8),name:"Brautschloss-Manager"}),n.ADMINISTRATOR=new n({id:a(9),name:"Administrator"}),n}),define("bridalapp/stockitem",["bridalapp/class","bridalapp/persistent"],function(e,t){var a=e("StockItem",t,{initialize:function($super,e){$super(e)}});return a}),define("bridalapp/stock",["bridalapp/class","bridalapp/syncheddatastore","bridalapp/localdatastore","bridalapp/restdatastore"],function(e,t){var a=e("Stock",t,{initialize:function($super){$super("stock","synched://local/bridal-app/stock#http/api/stock"),this.cfg.remoteDataStore.cfg.supportsSynch=!0}});return new a}),define("bridalapp/store",["bridalapp/class","bridalapp/named"],function(e,t){var a=e("Store",t,{initialize:function($super,e){$super(e)},getFullAddress:function(){return this.address1+(this.address2?", "+this.address2:"")+", "+this.postalCode+" "+this.city+(this.state?", "+this.state:"")+", "+Countries.byCode(this.countryCode)[0].name}});return a}),define("bridalapp/stores",["bridalapp/class","bridalapp/syncheddatastore","bridalapp/localdatastore","bridalapp/restdatastore"],function(e,t){var a=e("Stores",t,{initialize:function($super){$super("stores","synched://local/bridal-app/stores#http/api/stores"),this.cfg.remoteDataStore.cfg.supportsSynch=!0}});return new a}),/*! 
[bridalapp-client 0.9.18](http://github.com/download/bridalapp-client). Copyright 2015 by [Stijn de Witt](http://StijnDeWitt.com). Some rights reserved. License: [CC-BY-4.0](https://creativecommons.org/licenses/by/4.0/) */
define("bridalapp",["bridalapp/localdatastore","bridalapp/restdatastore","bridalapp/account","bridalapp/brand","bridalapp/brands","bridalapp/category","bridalapp/country","bridalapp/countries","bridalapp/credential","bridalapp/group","bridalapp/log","bridalapp/named","bridalapp/password-credential","bridalapp/persistent","bridalapp/product","bridalapp/products","bridalapp/rating","bridalapp/ratings","bridalapp/role","bridalapp/stockitem","bridalapp/stock","bridalapp/store","bridalapp/stores"],function(e,t,a,n,i,r,s,o,l,c,d,u,f,p,h,m,g,b,y,S,I,v,D){return{STATIC:"https://cdn.rawgit.com/download/bridalapp-static/0.9.12",APIKEY:"AIzaSyB75slLBHVw8DPQRRyYq6ZDjNuml3ZB_a4",Account:a,Brand:n,Brands:i,Category:r,Country:s,Countries:o,Credential:l,Group:c,log:d,Named:u,PasswordCredential:f,Persistent:p,Product:h,Products:m,Rating:g,Ratings:b,Role:y,StockItem:S,Stock:I,Store:v,Stores:D,globalize:function(e){for(var t in this)this.hasOwnProperty(t)&&"globalize"!==t&&(e[t]=this[t])}}});
//# sourceMappingURL=bridalapp.min.js
//# sourceMappingURL=bridalapp.min.js.map