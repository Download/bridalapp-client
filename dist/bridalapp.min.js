define("lang/class",[],function(){function Class(){var name="",parent=null,args=arrayify(arguments);("string"==typeof args[0]||args[0]instanceof String)&&(name=args.shift()),"function"==typeof args[0]&&(parent=args.shift());var classname=name||"klass";if(eval("var klass = function "+classname+"() {this.initialize.apply(this, arguments);}"),klass.classname=classname,klass.superclass=parent,klass.subclasses=[],parent){var subclass=function(){};subclass.prototype=parent.prototype,klass.prototype=new subclass,parent.subclasses.push(klass)}for(var i=0,len=args.length;len>i;i++)addMethods(klass,args[i]);return klass.prototype.initialize||(klass.prototype.initialize=function(){}),klass.prototype.constructor=klass,klass}function argumentNames(t){var e,n,r=t.toString().match(/^[\s\(]*function[^(]*\((.*?)\)/)[1].split(",");for(e=0,n=r.length;n>e;e++)r[e]=r[e].replace(/^\s+/,"").replace(/\s+$/,"");return 1!==n||r[0]?r:[]}function arrayify(t){if(!t)return[];if("toArray"in Object(t))return t.toArray();for(var e=t.length||0,n=new Array(e);e--;)n[e]=t[e];return n}function bind(t){if(arguments.length<3&&void 0===arguments[1])return t;var e=arrayify(arguments),n=e.splice(0,2)[1];return function(){return t.apply(n,e.concat(arrayify(arguments)))}}function wrap(t,e){return function(){return e.apply(this,[bind(t,this)].concat(arrayify(arguments)))}}function addMethods(t,e){function n(t){var e=[];for(var n in t)e.push(n);return e}for(var r,i=t.superclass&&t.superclass.prototype,s=n(e),a=0;r=s[a];a++){var o=e[r];if(i&&"function"==typeof o){var c=argumentNames(o);if(c.length>0&&"$super"===c[0]){var u=o;o=wrap(function(t){return function(){return i[t].apply(this,arguments)}}(r),u),o.valueOf=bind(u.valueOf,u),o.toString=bind(u.toString,u)}}t.prototype[r]=o}}return Class.subclass=function(t,e){if(t){if(t.classname===e)return t;for(var n,r=0;n=t.subclasses[r];r++){if(n.classname===e)return n;var i=Class.subclass(n,e);if(i)return i}}},Class}),define("bridalapp/persistent",["lang/class","suid"],function(t,e){var n=t("Persistent",{initialize:function(t){this.id=t&&t.id||e(0),this.type=this.constructor.classname,this.version=t&&void 0!==t.version?t.version:null},equals:function(t){return t&&(t instanceof n&&t.id.value===this.id.value||t instanceof e&&t.value===this.id.value||t==this.id.value)},toString:function(){return"[Object "+this.type+" "+this.id.toString()+" v"+this.version+"]"}});return n.revive=function(r,i){var s=i&&"object"==typeof i&&"string"==typeof i.type&&i.type,a=t.subclass(n,s);return a?new a(i):e.revive(r,i)},n.fromJSON=function(t){return JSON.parse(t,n.revive)},n.persistent=function(t){if(1===arguments.length)return t instanceof n&&null!==t.version;for(var e=[],r=0;t=arguments[r];r++)if(n.persistent(t))e.push(t);else if("length"in t)for(var i,s=0;i=t[s];s++)n.persistent(i)&&e.push(i);return e},n.equals=function(t,e,n){return t==e||n&&0===n(t,e)||t&&t.equals&&t.equals(e)||e&&e.equals&&e.equals(t)||"object"==typeof t&&t&&t.valueOf()==e||"object"==typeof e&&e&&e.valueOf()==t},n.indexOf=function(t,e){for(var r,i=0;r=t[i];i++)if(n.equals(r,e))return i;return-1},n.matches=function(t,e){var r=Array.prototype.concat.call(t||[]);if(e)for(var i=r.length-1;i>=0;i--)for(var s in e)e.hasOwnProperty(s)&&((Array.isArray&&Array.isArray(e[s])||e[s]instanceof Array)&&-1===n.indexOf(e[s],t[i][s])||!n.equals(t[i][s],e[s]))&&r.splice(i,1);return r},n.pluck=function(t,e){for(var n,r=[],i=0;n=t[i];i++)void 0!==n[e]&&r.push(n[e]);return r},n.clone=function(t){var e=[];if(arguments.length>1)return n.clone(arguments);if(!("length"in t))return t instanceof n&&t.clone?t.clone():n.fromJSON(JSON.stringify(t));for(var r,e=[],i=0;r=t[i];i++)e.push(n.clone(r));return e},n.page=function(t,e,n){if(e){var r=(n||0)*e,i=n*(e+1);return 0>i||r>=i||r>t.length?[]:t.slice(Math.max(r,0),Math.min(i,t.length))}return t},n.eachArg=function(t,e,r){if("length"in t&&!(t instanceof n)){for(var i,s=[],a=0;i=t[a];a++)s.push.apply(s,n.eachArg(i,e,r));return s}return r.call(e,t)},n}),define("bridalapp/named",["lang/class","bridalapp/persistent"],function(t,e){var n=t("Named",e,{initialize:function(t,e){t(e),this.name=e&&e.name||null},toString:function(){return"[Object "+this.type+" '"+this.name+"' "+this.id.toString()+" v"+this.version+"]"}});return n}),define("bridalapp/account",["lang/class","bridalapp/named"],function(t,e){var n=t("Account",e,{initialize:function(t,e){t(e),this.roles=e&&e.roles||[],this.groups=e&&e.groups||[],this.credentials=e&&e.credentials||[]}});return n}),define("bridalapp/brand",["lang/class","bridalapp/named"],function(t,e){var n=t("Brand",e,{initialize:function(t,e){t(e)}});return n}),define("bridalapp/log",[],function(){function t(){return i}var e,n,r=["log","info","warn","error"],i="console"in this&&console.error?console:{},s={},a={};for(e=0;n=r[e];e++)a[n]=function(){},s[n]=i[n]||a[n];t.level=function(t){if(void 0!==t&&t>=0&&4>=t&&t!==o){o=t;for(var e,n=0;e=r[n];n++)i[e]=n>=t?s[e]:a[e]}return o},t.level.DEBUG=0,t.level.INFO=1,t.level.WARN=2,t.level.ERROR=3,t.level.NONE=4;var o=t.level.DEBUG;return t}),define("bridalapp/datastore",["lang/class"],function(t){"use strict";var e=t("DataStore",{initialize:function(t,e,n){this.name=t,this.url=e||"",this.cfg=n||{},this.cfg.listeners=this.cfg.listeners||{},this.cfg.throttle=this.cfg.throttle||{}},on:function(t,e){this.cfg.listeners[t]=this.cfg.listeners[t]||[],this.cfg.listeners[t].push(e)},trigger:function(t){var e=this,n=e.cfg,r=n.listeners[t];if(r){n.throttle[t]||(n.throttle[t]={triggered:Date.now()});var i=n.throttle[t];i.timeout&&Date.now()<i.triggered+250?clearTimeout(i.timeout):i.triggered=Date.now(),i.timeout=setTimeout(function(){for(var t,n=0;t=r[n];n++)t.call(e);i.timeout=null},10)}},off:function(t,e){if(this.cfg.listeners[t]){if(!e){var n=this.cfg.listeners[t];return delete this.cfg.listeners[t],n}for(var r=this.cfg.listeners[t].length-1;r>=0;r--)if(this.cfg.listeners[t][r]===e)return this.cfg.listeners[t].splice(r,1)}},load:function(){return new Promise(function(t){t([])})},count:function(){return new Promise(function(t){t(0)})},save:function(t){return new Promise(function(e){e(void 0===t.length?[t]:t)})},"delete":function(t){return new Promise(function(e){e("length"in t?t:[t])})},toString:function(){return"[Object "+this.constructor.classname+" '"+this.name+"' {url: '"+this.url+"'}]"}});return e.typeFactories={},e.registerType=function(t,n){e.typeFactories[t]||(e.typeFactories[t]=n)},e.fromType=function(t,n,r,i){return e.typeFactories[n](t,r,i)},e.fromUrl=function(t,n,r){if(!n)return null;var i=n.indexOf("://"),s=n.substring(0,i),a="https"===s?"http":s||"http";return e.fromType(t,a,n,r)},e}),define("bridalapp/synchabledatastore",["suid","lang/class","bridalapp/datastore"],function(t,e,n){"use strict";var r=e("SynchableDataStore",n,{initialize:function(t,e,n,r){t(e,n,r)},get:function(t,e,n,r){var i=r?Persistent.clone(this.items()):this.items();return Persistent.page(Persistent.matches(i,t),e,n)},len:function(t){return this.get(t).length},looksSynched:function(){return 0!==this.lastSynched().getTime()&&!(this.createdItems().length||this.updatedItems().length||this.deletedItems().length)},synch:function(){return new Promise(function(t){t()})},isSynching:function(){return!1},lastSynched:function(t){return t||new Date},items:function(){},createdItems:function(){return[]},updatedItems:function(){return[]},deletedItems:function(){return[]},staleItems:function(){return[]},failedItems:function(){return[]},futureItems:function(){return[]},set:function(t){return t},del:function(t){return t},toString:function(t){var e=t();return e=e.substring(0,e.length-2),"[Object "+this.constructor.classname+" '"+this.name+"' {url: '"+this.url+"', lastSynched:"+this.lastSynched()+", items:"+this.items().length+", created:"+this.createdItems().length+", updated:"+this.updatedItems().length+", deleted:"+this.deletedItems().length+", stale:"+this.staleItems().length+", failed:"+this.failedItems().length+"}]"}});return r}),define("bridalapp/synchrequest",["lang/class"],function(t){var e=t("SynchRequest",{initialize:function(t){this.unsynchedDuration=t&&t.synchDuration||0,this.criteria=t&&t.criteria||null,this.currentIds=t&&t.currentIds||[],this.currentVersions=t&&t.currentVersions||[],this.createdItems=t&&t.createdItems||[],this.updatedItems=t&&t.updatedItems||[],this.deletedItems=t&&t.deletedItems||[]}});return e}),define("bridalapp/synchresponse",["lang/class"],function(t){var e=t("SynchResponse",{initialize:function(t){this.createdItems=t&&t.createdItems||[],this.updatedItems=t&&t.updatedItems||[],this.staleItems=t&&t.staleItems||[],this.failedItems=t&&t.failedItems||[],this.deletedIds=t&&t.deletedIds||[]}});return e}),define("bridalapp/syncheddatastore",["lang/class","jquery","bridalapp/log","bridalapp/persistent","bridalapp/datastore","bridalapp/synchabledatastore","bridalapp/synchrequest","bridalapp/synchresponse"],function(t,e,n,r,i,s,a){"use strict";function o(t,e){for(var n,i,s,a=!1,o=0;n=e[o];o++)s=r.indexOf(t.items(),n),-1===s?(s=r.indexOf(t.deletedItems(),n),-1!==s?n.version!==t.deletedItems()[s].version&&(t.deletedItems().splice(s,1),t.items().push(n)):t.items().push(n),a=!0):n.version!==t.items()[s].version&&(i=t.items().splice(s,1,n)[0],s=r.indexOf(t.updatedItems(),i),-1!==s&&(t.updatedItems().splice(s,1),s=r.indexOf(t.staleItems(),i),-1===s?t.staleItems().push(i):t.staleItems().splice(s,1,i)),a=!0);for(var o=t.items().length-1;o>=0;o--)if(n=t.items()[o],-1===r.indexOf(e,n)&&-1===r.indexOf(t.createdItems(),n)){var i=t.items().splice(o,1)[0];s=r.indexOf(t.updatedItems(),i),-1!==s&&(this.updatedItems().splice(s,1),s=r.indexOf(t.staleItems(),i),-1===staleIdx?t.staleItems().push(i):t.staleItems().splice(s,1,i)),a=!0}a&&t.trigger("change")}function c(t,e){for(var n,i=0;n=e[i];i++){var s=r.indexOf(t.futureItems(),n);if(-1!==s){var a=t.futureItems().splice(s,1)[0];s=r.indexOf(t.updatedItems(),n),-1!==s?t.updatedItems().splice(s,1,n):t.updatedItems().push(n);var o=r.clone(n);for(var c in a)"version"!==c&&(o[c]=a[c]);s=r.indexOf(t.items(),n),-1!==s&&t.items().splice(s,1,o)}else s=r.indexOf(t.updatedItems(),n),-1!==s&&t.updatedItems().splice(s,1),s=r.indexOf(t.items(),n),-1!==s&&t.items().splice(s,1,n)}}function u(t,e){for(var n,i=0;n=e[i];i++){var s=r.indexOf(t.deletedItems(),n);-1!==s&&t.deletedItems().splice(s,1)}}function l(t){var e=t.cfg;return t.synching=new Promise(function(n,i){return t.looksSynched()&&Date.now()<t.lastSynched().getTime()+e.pollInterval?setTimeout(function(){t.synching=!1,n()},0):(t.trigger("synch:started"),void e.remoteDataStore.load().then(function(s){o(t,s);for(var a,l=t.createdItems().concat(),d=0;a=t.updatedItems()[d];d++){var f=r.indexOf(t.items(),a);-1!==f&&l.push(t.items()[f])}var h=t.deletedItems().concat();new Promise(function(n,r){return h.length?void e.remoteDataStore["delete"](h).then(function(e){u(t,e),n()})["catch"](function(t){r(t)}):void n()}).then(function(){new Promise(function(n,r){return l.length?void e.remoteDataStore.save(l).then(function(e){c(t,e),n()})["catch"](function(t){r(t)}):void n()}).then(function(){t.lastSynched(new Date),t.synching=!1,t.synchError=!1,t.trigger("synch:success"),n(),t.trigger("synch:done")})["catch"](function(t){i(t)})})["catch"](function(t){i(t)})})["catch"](function(e){t.synching=!1,t.synchError=e,t.trigger("synch:failed"),i(e),t.trigger("synch:done")}))})}function d(t){t.autoSynchActive||(t.autoSynchActive=!0,setInterval(function(){t.synch()},t.cfg.synchInterval))}var f=t("SynchedDataStore",s,{initialize:function(t,e,r,a){if(t(e,r,a),this.synching=!1,this.synchError=!1,a=this.cfg,void 0===a.autoSynch&&(a.autoSynch=!0),a.synchInterval||(a.synchInterval=3e4),a.pollInterval||(a.pollInterval=18e5),void 0===a.remoteSynch&&(a.remoteSynch=!0),!a.localDataStore||!a.remoteDataStore){var o=r.split("://")[1].split("#");if(!a.localDataStore){var c=o[0].split("/"),u=c[0],l=c.slice(1,c.length-1).join("/"),d=c[c.length-1];a.localDataStore=i.fromType(e,u,u+"://"+l+"/"+d),a.localDataStore instanceof s||n().error(a.localDataStore?"Unable to initialize SynchedDataStore '"+e+"'.Need a synchable datastore for the local side, but "+a.localDataStore+" is not a SynchableDataStore.":"Unable to initialize SynchedDataStore '"+e+"'.Need a synchable datastore for the local side, but could not find a datastore for url '"+o[0]+"'.")}if(!a.remoteDataStore){var f=o[1].split("/"),h=f[0],p=f.slice(1,f.length-1).join("/"),g=f[f.length-1];a.remoteDataStore=i.fromType(e,h,"/"+p+"/"+g),a.remoteDataStore||n().error("Unable to initialize SynchedDataStore '"+e+"'.Need a datastore for the remote side, but could not find a datastore for url '"+o[1]+"'.")}}},synch:function(){this.cfg.autoSynch&&d(this);var t=this,e=t.cfg;return t.synching?t.synching:(t.synchError=!1,e.remoteDataStore.cfg.supportsSynch?t.synching=new Promise(function(i,s){if(t.looksSynched()&&Date.now()<t.lastSynched().getTime()+e.pollInterval)return setTimeout(function(){t.synching=!1,i()},0);t.trigger("synch:started");var o=!1,c=new a;c.criteria=e.filter||null,c.createdItems.push.apply(c.createdItems,t.createdItems()),c.updatedItems.push.apply(c.updatedItems,t.updatedItems()),c.deletedItems.push.apply(c.deletedItems,t.deletedItems()),c.currentIds.push.apply(c.currentIds,r.pluck(t.items(),"id")),c.currentVersions.push.apply(c.currentVersions,r.pluck(t.items(),"version")),e.remoteDataStore.synch(c).then(function(e){var s,a,c,u;if(e.deletedIds.length){for(s=0;a=e.deletedIds[s];s++)c=r.indexOf(t.items(),a),-1!==c&&(t.items().splice(c,1),o=!0),c=r.indexOf(t.deletedItems(),a),-1!==c&&t.deletedItems().splice(c,1);n().log("Processed "+e.deletedIds.length+" deleted items.")}if(e.updatedItems.length){for(s=0;u=e.updatedItems[s];s++)if(c=r.indexOf(t.futureItems(),u),-1!==c){var l=t.futureItems().splice(c,1)[0];c=r.indexOf(t.updatedItems(),u),-1!==c?t.updatedItems().splice(c,1,u):t.updatedItems().push(u);var d=r.clone(u);for(var f in l)"version"!==f&&(d[f]=l[f]);c=r.indexOf(t.items(),u),-1!==c&&t.items().splice(c,1,d)}else c=r.indexOf(t.updatedItems(),u),-1!==c?t.updatedItems().splice(c,1):o=!0,c=r.indexOf(t.items(),u),-1!==c?t.items().splice(c,1,u):t.items().push(u);n().log("Processed "+e.updatedItems.length+" updated items.")}if(e.createdItems.length){for(s=0;u=e.createdItems[s];s++)c=r.indexOf(t.items(),u),-1===c?(t.items().push(u),o=!0):t.items().splice(c,1,u);n().log("Processed "+e.createdItems.length+" created items.")}if(e.staleItems.length){for(s=0;u=e.staleItems[s];s++)c=r.indexOf(t.staleItems(),u),-1===c?t.staleItems().push(u):t.staleItems().splice(c,1,u);n().log("Processed "+e.staleItems.length+" stale items.")}if(e.failedItems.length){for(s=0;u=e.failedItems[s];s++)c=r.indexOf(t.failedItems(),u),-1===c?t.failedItems().push(u):t.failedItems().splice(c,1,u);n().log("Processed "+e.failedItems.length+" failed items.")}t.lastSynched(new Date),t.synching=!1,o&&t.trigger("change"),t.trigger("synch:success"),i(),t.trigger("synch:done")})["catch"](function(e){t.synching=!1,t.synchError=e,t.trigger("synch:failed"),s(e),t.trigger("synch:done")})}):l(t))},isSynching:function(){return!!this.synching},load:function(t,e,n){var r=this;return new Promise(function(i,s){this.synch().then(function(){r.cfg.localDataStore.load(t,e,n).then(function(t){i(t)})})["catch"](function(t){s(t)})})},count:function(t){var e=this;return new Promise(function(n,r){this.synch().then(function(){e.cfg.localDataStore.count(t,pageSize,pageIndex).then(function(t){n(t)})["catch"](function(t){r(t)})})["catch"](function(t){r(t)})})},save:function(t){var e=this;return new Promise(function(n,r){e.cfg.localDataStore.save(t).then(function(t){e.synch().then(function(){n(t)})["catch"](function(t){r(t)})})["catch"](function(t){r(t)})})},"delete":function(t){var e=this;return new Promise(function(n,r){e.cfg.localDataStore["delete"](t).then(function(t){e.synch().then(function(){n(t)})["catch"](function(t){r(t)})})["catch"](function(t){r(t)})})},lastSynched:function(t){return this.cfg.localDataStore.lastSynched(t)},items:function(){return this.cfg.localDataStore.items()},createdItems:function(){return this.cfg.localDataStore.createdItems()},updatedItems:function(){return this.cfg.localDataStore.updatedItems()},deletedItems:function(){return this.cfg.localDataStore.deletedItems()},staleItems:function(){return this.cfg.localDataStore.staleItems()},failedItems:function(){return this.cfg.localDataStore.failedItems()},futureItems:function(){return this.cfg.localDataStore.futureItems()},set:function(t){return this.cfg.localDataStore.set(t)},del:function(t){return this.cfg.localDataStore.del(t)}});return i.registerType("synched",function(t,e,n){return new f(t,e,n)}),f}),define("bridalapp/rhaboodatastore",["lang/class","bridalapp/datastore","bridalapp/synchabledatastore","bridalapp/persistent","rhaboo"],function(t,e,n,r){"use strict";var i=t("RhabooDataStore",n,{initialize:function(t,e,n,r){if(t(e,n,r),!this.cfg.rhaboo||!this.cfg.store){var i=n.indexOf("://")+3,s=n.lastIndexOf("/"),a=n.substring(i,s),o=n.substring(s+1);this.cfg.repo||(this.cfg.repo=a),this.cfg.store||(this.cfg.store=o)}},load:function(t,e,n){return new Promise(function(r){r(this.get(t,e,n))})},count:function(){return new Promise(function(t){t(this.len())})},save:function(t){return new Promise(function(e){e(this.set(t))})},"delete":function(t){return new Promise(function(e){e(this.del(t))})},set:function(){var t=r.eachArg(arguments,this,function(t){var e=null,n=r.indexOf(this.db().items,t);return-1===n?this.db().items.push(t):e=this.db().items.splice(n,1,t)[0],n=r.indexOf(this.db().deleted,t),-1!==n&&(e=this.db().deleted.splice(n,1)),e&&(n=r.indexOf(this.db().updated,t),-1===n?this.db().updated.push(e):this.synching&&(n=r.indexOf(this.db().future,t),-1===n?this.db().future.push(t):this.db().future.splice(n,1,t))),[t]});return this.trigger("change"),t},del:function(){var t=r.eachArg(arguments,this,function(t){var e,n=r.indexOf(this.items(),t);if(-1!==n&&(e=this.items().splice(n,1)[0]),r.persistent(t)){if(n=r.indexOf(this.db().updated,t),-1!==n){var i=this.db().updated.splice(n,1);e=e||i}n=r.indexOf(this.db().future,t),-1!==n&&this.db().future.splice(n,1),n=r.indexOf(this.db().deleted,t),-1===n&&this.db().deleted.push(e||t)}return[e||t]});return this.trigger("change"),t},lastSynched:function(t){return t&&this.db().write("lastSynched",t),this.db().lastSynched},items:function(){return this.db().items},createdItems:function(){for(var t,e=[],n=0;t=this.items()[n];n++)r.persistent(t)||e.push(t);return e},updatedItems:function(){return this.db().updated},deletedItems:function(){return this.db().deleted},staleItems:function(){return this.db().stale},failedItems:function(){return this.db().failed},futureItems:function(){return this.db().future},db:function(){if(!this.cfg.rhaboo){this.cfg.rhaboo=Rhaboo.persistent(this.cfg.repo),this.cfg.rhaboo[this.cfg.store]||this.cfg.rhaboo.write(this.cfg.store,{});for(var t,e=0;t=["items","updated","deleted","stale","failed","future"][e];e++)this.db()[t]||this.db().write(t,[]);this.db().lastSynched||this.db().write("lastSynched",new Date(0))}return this.cfg.rhaboo[this.cfg.store]}});return e.registerType("rhaboo",function(t,e,n){return new i(t,e,n)}),i}),define("bridalapp/restdatastore",["lang/class","jquery","bridalapp/log","bridalapp/persistent","bridalapp/datastore"],function(t,e,n,r,i){"use strict";function s(t,e,n){return new a(t,e,n)}var a=t("RestDataStore",i,{initialize:function(t,e,n,r){t(e,n,r),this.cfg.retryCount=this.cfg.retryCount||0,this.cfg.retryWaitTime=this.cfg.retryWaitTime||2e3,this.cfg.timeout=this.cfg.timeout||1e4,void 0===this.cfg.supportsSynch&&(this.cfg.supportsSynch=!1)},load:function(t,e,n){return this.remoteRequest("GET",this.url,{criteria:t,pageSize:e,pageIndex:n})},count:function(t){return new Promise(function(e,n){this.remoteRequest("GET",this.url,{criteria:t}).then(function(t){e(t.length)})["catch"](function(t){n(t)})})},save:function(t){var e=r.eachArg(t,this,function(t){return[t]});return this.remoteRequest("POST",this.url+"/save",e)},"delete":function(t){var e=r.eachArg(t,this,function(t){return[t]});return this.remoteRequest("DELETE",this.url,e)},synch:function(t){return this.remoteRequest("POST",this.url+"/synch",t)},remoteRequest:function(t,i,s){return function(t,i,s,a,o){function c(t){var e="";if(t)if(t.length)e="("+t.length+" items)";else if(t.createdItems){var n=[];t.createdItems.length&&n.push(t.createdItems.length+" created"),t.updatedItems.length&&n.push(t.updatedItems.length+" updated"),t.deletedItems&&t.deletedItems.length&&n.push(t.deletedItems.length+" deleted"),t.deletedIds&&t.deletedIds.length&&n.push(t.deletedIds.length+" deleted"),n.length&&(e="("+n.join(", ")+")")}return e}function u(t,i,s,u,l,d){for(var f="",h=0;h<6-t.length;h++)f+=" ";n().log(" -> "+f+t+" "+i+" "+c(s)),e.ajax(i,{method:t,contentType:"application/json",processData:!1,data:s&&JSON.stringify(s),timeout:a}).done(function(e,s,a){-1!==a.responseText.indexOf("j_security_check")?(n().info("401 "+f+t+" "+i+" "+c(e)+" (LOGIN CHALLENGE)"),u(a,t,i,e,l,d)):(n().info("200 "+f+t+" "+i+" "+c(e)+" (OK)"),o=0,l(r.fromJSON(a.responseText)))}).fail(function(e,r,a){e.statusText=a||r,n().warn(e.status+" "+f+t+" "+i+" "+c(s)+" ("+e.statusText+")"),u(e,t,i,s,l,d)})}function l(t,e,n,r,i,s){var a=t.statusText;switch(status){case 500:case 502:case 503:case 504:if(o>0){d(t,e,n,r,errorHandler,i,s);break}case 200:200==t.status&&(a="Session expired.");default:o=0;var c=new Error(t.status+" "+a);c.status=t.status,c.statusText=a,c.request=t,c.method=e,c.url=n,c.data=r,s(c)}}function d(t,e,n,r,i,s,a){o--;var c=3e3,l=t.getResponseHeader("Retry-After");if(l){var d=parseInt(l,10);isNaN(d)||(c=1e3*d)}setTimeout(function(){u(e,n,r,errorhandler,s,a)},c)}Date.now();return new Promise(function(e,n){if("GET"===t&&s){var r=i.indexOf("#"),a=-1!==r?i.substring(r):"",o=i.indexOf("?"),c=-1!==o?i.substring(o):"";if(s.criteria)for(var d in s.criteria)s.criteria.hasOwnProperty(d)&&(c+=(c?"&":"")+encodeURIComponent(d)+"="+encodeURIComponent(s.criteria[d].toString()));s.pageSize&&(c+=(c?"&":"")+"pg="+s.pageIndex+"&pgsz="+s.pageSize),i=i+c+a,s=void 0}u(t,i,s,l,e,n)})}(t,i,s,this.cfg.timeout,this.cfg.retryCount,this.cfg.retryWaitTime)}});return i.registerType("http",s),i.registerType("https",s),a}),define("bridalapp/brands",["lang/class","jquery","bridalapp/syncheddatastore","bridalapp/rhaboodatastore","bridalapp/restdatastore"],function(t,e,n){var r=t("Brands",n,{initialize:function(t){t("brands","synched://rhaboo/bridal-app/brands#http/api/brands")}});return new r}),define("bridalapp/category",["lang/class","bridalapp/named"],function(t,e){var n=t("Category",e,{initialize:function(t,e){t(e)}});return n}),define("bridalapp/credential",["lang/class","bridalapp/persistent"],function(t,e){var n=t("Credential",e,{initialize:function(t,e){t(e)}});return n}),define("bridalapp/group",["lang/class","bridalapp/named"],function(t,e){var n=t("Group",e,{initialize:function(t,e){t(e),this.description=e&&e.description||null}});return n}),define("bridalapp/password-credential",["lang/class","bridalapp/credential"],function(t,e){var n=t("PasswordCredential",e,{initialize:function(t,e){t(e),this.password=e&&e.password||null}});return n}),define("bridalapp/product",["lang/class","bridalapp/named"],function(t,e){var n=t("Product",e,{initialize:function(t,e){t(e),this.description=e&&e.description||null,this.priceWholesaleEuroCent=e&&e.priceWholesaleEuroCent||null,this.priceConsumerEuroCent=e&&e.priceConsumerEuroCent||null,this.brandId=e&&e.brandId||null,this.brandName=e&&e.brandName||null,this.categoryId=e&&e.categoryId||null,this.categoryName=e&&e.categoryName||null,this.tags=e&&e.tags||null}});return n}),define("bridalapp/products",["lang/class","jquery","bridalapp/syncheddatastore","bridalapp/rhaboodatastore","bridalapp/restdatastore"],function(t,e,n){var r=t("Products",n,{initialize:function(t){t("products","synched://rhaboo/bridal-app/products#http/api/products"),this.cfg.remoteDataStore.cfg.supportsSynch=!0}});return new r}),define("bridalapp/rating",["lang/class","bridalapp/persistent"],function(t,e){var n=t("Rating",e,{initialize:function(t,e){t(e),this.productId=e&&e.productId||null,this.accountId=e&&e.accountId||null,this.score=e&&e.score||null}});return n}),define("bridalapp/ratings",["lang/class","jquery","bridalapp/syncheddatastore","bridalapp/rhaboodatastore","bridalapp/restdatastore"],function(t,e,n){var r=t("Ratings",n,{initialize:function(t){t("ratings","synched://rhaboo/bridal-app/ratings#http/api/ratings"),this.cfg.remoteDataStore.cfg.supportsSynch=!0}});return new r}),define("bridalapp/role",["lang/class","bridalapp/named"],function(t,e){var n=t("Role",e,{initialize:function(t,e){t(e)}});return n}),define("bridalapp",["bridalapp/account","bridalapp/brand","bridalapp/brands","bridalapp/category","bridalapp/credential","bridalapp/group","bridalapp/log","bridalapp/named","bridalapp/password-credential","bridalapp/persistent","bridalapp/product","bridalapp/products","bridalapp/rating","bridalapp/ratings","bridalapp/role"],function(t,e,n,r,i,s,a,o,c,u,l,d,f,h,p){return{Account:t,Brand:e,Brands:n,Category:r,Credential:i,Group:s,log:a,Named:o,PasswordCredential:c,Persistent:u,Product:l,Products:d,Rating:f,Ratings:h,Role:p,globalize:function(t){for(var e in this)this.hasOwnProperty(e)&&(t[e]=this[e])}}});
//# sourceMappingURL=bridalapp.min.js
//# sourceMappingURL=bridalapp.min.js.map